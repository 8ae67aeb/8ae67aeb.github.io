!function(t){var e={};function i(s){if(e[s])return e[s].exports;var n=e[s]={i:s,l:!1,exports:{}};return t[s].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:s})},i.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=154)}([function(t,e,i){var s=i(39),n="object"==typeof self&&self&&self.Object===Object&&self,r=s||n||Function("return this")();t.exports=r},function(t,e){var i=Array.isArray;t.exports=i},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,i,s){return i&&t(e.prototype,i),s&&t(e,s),e}}();var n=function(t){function e(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var i=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.templateUrl&&i.initShadowRoot(t.templateUrl),i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,HTMLElement),s(e,[{key:"getElementById",value:function(t){return this.shadowRoot.getElementById(t)}},{key:"initShadowRoot",value:function(t){var e=document.querySelector('link[rel="import"][href="'+t+'"]').import.querySelector("template");this.attachShadow({mode:"open"}).appendChild(document.importNode(e.content,!0))}}]),e}();e.WebComponent=n},function(t,e,i){var s=i(134),n=i(128);t.exports=function(t,e){var i=n(t,e);return s(i)?i:void 0}},function(t,e){t.exports=function(t){return null!=t&&"object"==typeof t}},function(t,e,i){var s=i(11),n=i(132),r=i(131),o="[object Null]",h="[object Undefined]",a=s?s.toStringTag:void 0;t.exports=function(t){return null==t?void 0===t?h:o:a&&a in Object(t)?n(t):r(t)}},function(t,e,i){var s=i(7),n=1/0;t.exports=function(t){if("string"==typeof t||s(t))return t;var e=t+"";return"0"==e&&1/t==-n?"-0":e}},function(t,e,i){var s=i(5),n=i(4),r="[object Symbol]";t.exports=function(t){return"symbol"==typeof t||n(t)&&s(t)==r}},function(t,e,i){var s=i(119);t.exports=function(t,e){var i=t.__data__;return s(e)?i["string"==typeof e?"string":"hash"]:i.map}},function(t,e,i){var s=i(3)(Object,"create");t.exports=s},function(t,e){t.exports=function(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}},function(t,e,i){var s=i(0).Symbol;t.exports=s},function(t,e,i){var s=i(41);t.exports=function(t,e){for(var i=t.length;i--;)if(s(t[i][0],e))return i;return-1}},function(t,e,i){var s=i(144),n=i(143),r=i(142),o=i(141),h=i(140);function a(t){var e=-1,i=null==t?0:t.length;for(this.clear();++e<i;){var s=t[e];this.set(s[0],s[1])}}a.prototype.clear=s,a.prototype.delete=n,a.prototype.get=r,a.prototype.has=o,a.prototype.set=h,t.exports=a},function(t,e){t.exports={copyArrayElements:function(t,e,i,s,n){for(var r=0;r<n;++r)i[s+r]=t[e+r]},copyArray:function(t){for(var e=new Array(t.length),i=0;i<t.length;i++)e[i]=t[i];return e},fromJSON:function(t,e){for(var i=0;i<t.JSON_PROPERTIES.length;i++)t[t.JSON_PROPERTIES[i]]=e[t.JSON_PROPERTIES[i]]},toJSON:function(t){for(var e={},i=0;i<t.JSON_PROPERTIES.length;i++)e[t.JSON_PROPERTIES[i]]=t[t.JSON_PROPERTIES[i]];return e}}},function(t,e,i){t.exports={Controller:i(25),NES:i(61)}},function(t,e,i){var s=i(1),n=i(7),r=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,o=/^\w*$/;t.exports=function(t,e){if(s(t))return!1;var i=typeof t;return!("number"!=i&&"symbol"!=i&&"boolean"!=i&&null!=t&&!n(t))||o.test(t)||!r.test(t)||null!=e&&t in Object(e)}},function(t,e){var i=9007199254740991;t.exports=function(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=i}},function(t,e,i){var s=i(98),n=i(91),r=i(30);t.exports=function(t){return r(t)?s(t):n(t)}},function(t,e,i){var s=i(127),n=i(120),r=i(118),o=i(117),h=i(116);function a(t){var e=-1,i=null==t?0:t.length;for(this.clear();++e<i;){var s=t[e];this.set(s[0],s[1])}}a.prototype.clear=s,a.prototype.delete=n,a.prototype.get=r,a.prototype.has=o,a.prototype.set=h,t.exports=a},function(t,e,i){var s=i(3)(i(0),"Map");t.exports=s},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,i,s){return i&&t(e.prototype,i),s&&t(e,s),e}}();var n=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}return s(t,null,[{key:"empty",value:function(t){for(;t.firstChild;)t.removeChild(t.firstChild)}}]),t}();e.DOMUtils=n},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SyncBase=void 0;var s=function(){function t(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,i,s){return i&&t(e.prototype,i),s&&t(e,s),e}}(),n=i(51);var r=function(){function t(e,i){var s=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._peerDataChannel=e,this.screen=i,this.speakers=new n.Speakers({onBufferUnderrun:function(t,e){return s.speakersBufferUnderrun(t,e)}})}return s(t,[{key:"start",value:function(){this.speakers.start()}},{key:"buttonDown",value:function(t){}},{key:"buttonUp",value:function(t){}},{key:"handleEvent",value:function(t){}},{key:"frame",value:function(t){this.screen.writeBuffer()}},{key:"speakersWriteSample",value:function(t,e){this.speakers.writeSample(t,e)}},{key:"speakersBufferUnderrun",value:function(t,e){}},{key:"setFrameBuffer",value:function(t){this.screen.setBuffer(t)}},{key:"dataChannel",get:function(){return this._peerDataChannel}}]),t}();e.SyncBase=r},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,i,s){return i&&t(e.prototype,i),s&&t(e,s),e}}();var n=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}return s(t,[{key:"encode",value:function(t){var e=[],i=void 0,s=void 0,n=void 0;for(s=1,i=t[0],n=1;n<t.length;n++)t[n]!=i?(e.push(s,i),s=1,i=t[n]):s++;return e.push(s,i),e}},{key:"decode",value:function(t){for(var e=[],i=0;i<t.length-1;i+=2)for(var s=0;s<t[i];s++)e.push(t[i+1]);return e}}]),t}();e.RLECompression=n},function(t,e){var i=function(){this.pix=new Array(64),this.fbIndex=null,this.tIndex=null,this.x=null,this.y=null,this.w=null,this.h=null,this.incX=null,this.incY=null,this.palIndex=null,this.tpri=null,this.c=null,this.initialized=!1,this.opaque=new Array(8)};i.prototype={setBuffer:function(t){for(this.y=0;this.y<8;this.y++)this.setScanline(this.y,t[this.y],t[this.y+8])},setScanline:function(t,e,i){for(this.initialized=!0,this.tIndex=t<<3,this.x=0;this.x<8;this.x++)this.pix[this.tIndex+this.x]=(e>>7-this.x&1)+((i>>7-this.x&1)<<1),0===this.pix[this.tIndex+this.x]&&(this.opaque[t]=!1)},render:function(t,e,i,s,n,r,o,h,a,u,l,c,p){if(!(r<-7||r>=256||o<-7||o>=240))if(this.w=s-e,this.h=n-i,r<0&&(e-=r),r+s>=256&&(s=256-r),o<0&&(i-=o),o+n>=240&&(n=240-o),u||l)if(u&&!l)for(this.fbIndex=(o<<8)+r,this.tIndex=7,this.y=0;this.y<8;this.y++){for(this.x=0;this.x<8;this.x++)this.x>=e&&this.x<s&&this.y>=i&&this.y<n&&(this.palIndex=this.pix[this.tIndex],this.tpri=p[this.fbIndex],0!==this.palIndex&&c<=(255&this.tpri)&&(t[this.fbIndex]=a[this.palIndex+h],this.tpri=3840&this.tpri|c,p[this.fbIndex]=this.tpri)),this.fbIndex++,this.tIndex--;this.fbIndex-=8,this.fbIndex+=256,this.tIndex+=16}else if(l&&!u)for(this.fbIndex=(o<<8)+r,this.tIndex=56,this.y=0;this.y<8;this.y++){for(this.x=0;this.x<8;this.x++)this.x>=e&&this.x<s&&this.y>=i&&this.y<n&&(this.palIndex=this.pix[this.tIndex],this.tpri=p[this.fbIndex],0!==this.palIndex&&c<=(255&this.tpri)&&(t[this.fbIndex]=a[this.palIndex+h],this.tpri=3840&this.tpri|c,p[this.fbIndex]=this.tpri)),this.fbIndex++,this.tIndex++;this.fbIndex-=8,this.fbIndex+=256,this.tIndex-=16}else for(this.fbIndex=(o<<8)+r,this.tIndex=63,this.y=0;this.y<8;this.y++){for(this.x=0;this.x<8;this.x++)this.x>=e&&this.x<s&&this.y>=i&&this.y<n&&(this.palIndex=this.pix[this.tIndex],this.tpri=p[this.fbIndex],0!==this.palIndex&&c<=(255&this.tpri)&&(t[this.fbIndex]=a[this.palIndex+h],this.tpri=3840&this.tpri|c,p[this.fbIndex]=this.tpri)),this.fbIndex++,this.tIndex--;this.fbIndex-=8,this.fbIndex+=256}else for(this.fbIndex=(o<<8)+r,this.tIndex=0,this.y=0;this.y<8;this.y++){for(this.x=0;this.x<8;this.x++)this.x>=e&&this.x<s&&this.y>=i&&this.y<n&&(this.palIndex=this.pix[this.tIndex],this.tpri=p[this.fbIndex],0!==this.palIndex&&c<=(255&this.tpri)&&(t[this.fbIndex]=a[this.palIndex+h],this.tpri=3840&this.tpri|c,p[this.fbIndex]=this.tpri)),this.fbIndex++,this.tIndex++;this.fbIndex-=8,this.fbIndex+=256}},isTransparent:function(t,e){return 0===this.pix[(e<<3)+t]},toJSON:function(){return{opaque:this.opaque,pix:this.pix}},fromJSON:function(t){this.opaque=t.opaque,this.pix=t.pix}},t.exports=i},function(t,e){var i=function(){this.state=new Array(8);for(var t=0;t<this.state.length;t++)this.state[t]=64};i.BUTTON_A=0,i.BUTTON_B=1,i.BUTTON_SELECT=2,i.BUTTON_START=3,i.BUTTON_UP=4,i.BUTTON_DOWN=5,i.BUTTON_LEFT=6,i.BUTTON_RIGHT=7,i.prototype={buttonDown:function(t){this.state[t]=65},buttonUp:function(t){this.state[t]=64}},t.exports=i},function(t,e,i){var s=i(1),n=i(16),r=i(79),o=i(76);t.exports=function(t,e){return s(t)?t:n(t,e)?[t]:r(o(t))}},function(t,e,i){var s=i(26),n=i(6);t.exports=function(t,e){for(var i=0,r=(e=s(e,t)).length;null!=t&&i<r;)t=t[n(e[i++])];return i&&i==r?t:void 0}},function(t,e){t.exports=function(t,e){return function(i){return null!=i&&i[t]===e&&(void 0!==e||t in Object(i))}}},function(t,e,i){var s=i(10);t.exports=function(t){return t==t&&!s(t)}},function(t,e,i){var s=i(40),n=i(17);t.exports=function(t){return null!=t&&n(t.length)&&!s(t)}},function(t,e,i){var s=i(94),n=i(93),r=i(92),o=r&&r.isTypedArray,h=o?n(o):s;t.exports=h},function(t,e){var i=9007199254740991,s=/^(?:0|[1-9]\d*)$/;t.exports=function(t,e){var n=typeof t;return!!(e=null==e?i:e)&&("number"==n||"symbol"!=n&&s.test(t))&&t>-1&&t%1==0&&t<e}},function(t,e){t.exports=function(t){return t.webpackPolyfill||(t.deprecate=function(){},t.paths=[],t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),t.webpackPolyfill=1),t}},function(t,e,i){(function(t){var s=i(0),n=i(95),r="object"==typeof e&&e&&!e.nodeType&&e,o=r&&"object"==typeof t&&t&&!t.nodeType&&t,h=o&&o.exports===r?s.Buffer:void 0,a=(h?h.isBuffer:void 0)||n;t.exports=a}).call(this,i(33)(t))},function(t,e,i){var s=i(96),n=i(4),r=Object.prototype,o=r.hasOwnProperty,h=r.propertyIsEnumerable,a=s(function(){return arguments}())?s:function(t){return n(t)&&o.call(t,"callee")&&!h.call(t,"callee")};t.exports=a},function(t,e,i){var s=i(114),n=i(111),r=i(110),o=1,h=2;t.exports=function(t,e,i,a,u,l){var c=i&o,p=t.length,f=e.length;if(p!=f&&!(c&&f>p))return!1;var m=l.get(t);if(m&&l.get(e))return m==e;var d=-1,_=!0,g=i&h?new s:void 0;for(l.set(t,e),l.set(e,t);++d<p;){var R=t[d],b=e[d];if(a)var y=c?a(b,R,d,e,t,l):a(R,b,d,t,e,l);if(void 0!==y){if(y)continue;_=!1;break}if(g){if(!n(e,function(t,e){if(!r(g,e)&&(R===t||u(R,t,i,a,l)))return g.push(e)})){_=!1;break}}else if(R!==b&&!u(R,b,i,a,l)){_=!1;break}}return l.delete(t),l.delete(e),_}},function(t,e,i){var s=i(115),n=i(4);t.exports=function t(e,i,r,o,h){return e===i||(null==e||null==i||!n(e)&&!n(i)?e!=e&&i!=i:s(e,i,r,o,t,h))}},function(t,e){var i=Function.prototype.toString;t.exports=function(t){if(null!=t){try{return i.call(t)}catch(t){}try{return t+""}catch(t){}}return""}},function(t,e,i){(function(e){var i="object"==typeof e&&e&&e.Object===Object&&e;t.exports=i}).call(this,i(133))},function(t,e,i){var s=i(5),n=i(10),r="[object AsyncFunction]",o="[object Function]",h="[object GeneratorFunction]",a="[object Proxy]";t.exports=function(t){if(!n(t))return!1;var e=s(t);return e==o||e==h||e==r||e==a}},function(t,e){t.exports=function(t,e){return t===e||t!=t&&e!=e}},function(t,e,i){var s=i(13),n=i(139),r=i(138),o=i(137),h=i(136),a=i(135);function u(t){var e=this.__data__=new s(t);this.size=e.size}u.prototype.clear=n,u.prototype.delete=r,u.prototype.get=o,u.prototype.has=h,u.prototype.set=a,t.exports=u},function(t,e,i){var s=i(146),n=i(81),r=i(70),o=i(1),h=i(69);t.exports=function(t){return"function"==typeof t?t:null==t?r:"object"==typeof t?o(t)?n(t[0],t[1]):s(t):h(t)}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.router=e.AppComponent=void 0;var s=function(){function t(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,i,s){return i&&t(e.prototype,i),s&&t(e,s),e}}(),n=i(21),r=i(153),o=i(2);var h=new r.Router,a=function(t){function e(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var t=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,{templateUrl:"app-component.html"}));return t.outletElement=t.getElementById("outlet"),t.initRouter(),t}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,o.WebComponent),s(e,[{key:"initRouter",value:function(){var t=this;h.add(/^\S+$/,function(){return t.onGameRoute()}),h.add(function(){return t.onHomeRoute()}),h.listen()}},{key:"onHomeRoute",value:function(){this.clearOutlet();var t=document.createElement("x-home");this.outletElement.appendChild(t)}},{key:"onGameRoute",value:function(){this.clearOutlet();var t=document.createElement("x-game");this.outletElement.appendChild(t)}},{key:"clearOutlet",value:function(){n.DOMUtils.empty(this.outletElement)}}]),e}();e.AppComponent=a,e.router=h},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,i,s){return i&&t(e.prototype,i),s&&t(e,s),e}}();var n=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}return s(t,null,[{key:"authenticate",value:function(){firebase.auth().signInAnonymously().catch(function(t){t&&alert("Authentication error. Code: "+t.code+"; Message: "+t.message+".")}),firebase.auth().onAuthStateChanged(function(e){e?(t.isAnonymous=e.isAnonymous,t.uid=e.uid):(t.isAnonymous=null,t.uid=null)})}},{key:"uid",set:function(e){t._uid=e},get:function(){return t._uid}},{key:"isAnonymous",set:function(e){t._isAnonymous=e},get:function(){return t._isAnonymous}}]),t}();e.AuthUser=n},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.RouteLinkComponent=void 0;var s=function(){function t(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,i,s){return i&&t(e.prototype,i),s&&t(e,s),e}}(),n=i(44),r=i(2);var o=function(t){function e(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var t=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,{templateUrl:"common/route-link/route-link.html"}));return t.link=t.getElementById("link"),t.link.addEventListener("click",function(){return n.router.navigate(t.path)}),t}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,r.WebComponent),s(e,[{key:"attributeChangedCallback",value:function(t,e,i){switch(t){case"path":e!=i&&(this.path=i)}}},{key:"path",get:function(){return this.getAttribute("path")},set:function(t){t?(this.link.setAttribute("href",t),this.setAttribute("path",t)):(this.link.setAttribute("href","#"),this.removeAttribute("path"))}}],[{key:"observedAttributes",get:function(){return["path"]}}]),e}();e.RouteLinkComponent=o},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ScreenComponent=void 0;var s=function(){function t(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,i,s){return i&&t(e.prototype,i),s&&t(e,s),e}}(),n=i(2);var r=function(t){function e(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var t=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,{templateUrl:"game/screen/screen.html"}));return t.initCanvas(),t}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,n.WebComponent),s(e,[{key:"initCanvas",value:function(){this.canvas=this.shadowRoot.getElementById("canvas"),this.canvas.width=256,this.canvas.height=240,this.context=this.canvas.getContext("2d"),this.imageData=this.context.getImageData(0,0,256,240),this.context.fillStyle="black",this.context.fillRect(0,0,256,240),this.buf=new ArrayBuffer(this.imageData.data.length),this.buf8=new Uint8ClampedArray(this.buf),this.buf32=new Uint32Array(this.buf);for(var t=0;t<this.buf32.length;++t)this.buf32[t]=4278190080}},{key:"setBuffer",value:function(t){for(var e=0,i=0;i<240;++i)for(var s=0;s<256;++s)e=256*i+s,this.buf32[e]=4278190080|t[e]}},{key:"writeBuffer",value:function(){this.imageData.data.set(this.buf8),this.context.putImageData(this.imageData,0,0)}}]),e}();e.ScreenComponent=r},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.GameMultiplayerRoomListComponent=void 0;var s=function(){function t(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,i,s){return i&&t(e.prototype,i),s&&t(e,s),e}}(),n=i(21),r=i(2);var o=function(t){function e(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var t=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,{templateUrl:"game/game-multiplayer/game-multiplayer-room-list/game-multiplayer-room-list.html"}));return t.roomListElement=t.getElementById("room-list"),t}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,r.WebComponent),s(e,[{key:"setRoomList",value:function(t){var e=this;n.DOMUtils.empty(this.roomListElement),t.forEach(function(t){var i=document.createElement("li");i.innerText=t.id,i.addEventListener("click",function(i){return e.fireRoomSelectedEvent(t)}),e.roomListElement.appendChild(i)})}},{key:"fireRoomSelectedEvent",value:function(t){var e=new CustomEvent("room-selected",{detail:t});this.dispatchEvent(e)}}]),e}();e.GameMultiplayerRoomListComponent=o},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SlaveSync=void 0;var s=function(){function t(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,i,s){return i&&t(e.prototype,i),s&&t(e,s),e}}(),n=function t(e,i,s){null===e&&(e=Function.prototype);var n=Object.getOwnPropertyDescriptor(e,i);if(void 0===n){var r=Object.getPrototypeOf(e);return null===r?void 0:t(r,i,s)}if("value"in n)return n.value;var o=n.get;return void 0!==o?o.call(s):void 0},r=i(23),o=i(22);var h=function(t){function e(t,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var s=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i));return s.remoteFrameBuffer=null,s}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,o.SyncBase),s(e,[{key:"buttonDown",value:function(t){n(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"buttonDown",this).call(this,t),n(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"dataChannel",this).send(JSON.stringify({code:"buttonDown",data:{button:t}}))}},{key:"buttonUp",value:function(t){n(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"buttonUp",this).call(this,t),n(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"dataChannel",this).send(JSON.stringify({code:"buttonUp",data:{button:t}}))}},{key:"handleEvent",value:function(t){n(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"handleEvent",this).call(this,t),t instanceof ArrayBuffer&&this.remoteFrame(t)}},{key:"remoteFrame",value:function(t){var e=Array.from(new Uint32Array(event.data)),i=(16777216&e[e.length-1])>>24;if(this.remoteFrameBuffer?Array.prototype.splice.apply(this.remoteFrameBuffer,[this.remoteFrameBuffer.length,0].concat(e)):this.remoteFrameBuffer=e,i){var s=(new r.RLECompression).decode(this.remoteFrameBuffer);this.setFrameBuffer(s),this.remoteFrameBuffer=null}}},{key:"frame",value:function(t){n(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"frame",this).call(this,t)}},{key:"speakersBufferUnderrun",value:function(t,i){n(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"speakersBufferUnderrun",this).call(this,t,i)}}]),e}();e.SlaveSync=h},function(t,e){function i(t,e){this._elements=new Array(t||50),this._first=0,this._last=0,this._size=0,this._evictedCb=e}t.exports=i,i.prototype.capacity=function(){return this._elements.length},i.prototype.isEmpty=function(){return 0===this.size()},i.prototype.isFull=function(){return this.size()===this.capacity()},i.prototype.peek=function(){if(this.isEmpty())throw new Error("RingBuffer is empty");return this._elements[this._first]},i.prototype.peekN=function(t){if(t>this._size)throw new Error("Not enough elements in RingBuffer");var e=Math.min(this._first+t,this.capacity()),i=this._elements.slice(this._first,e);if(e<this.capacity())return i;var s=this._elements.slice(0,t-i.length);return i.concat(s)},i.prototype.deq=function(){var t=this.peek();return this._size--,this._first=(this._first+1)%this.capacity(),t},i.prototype.deqN=function(t){var e=this.peekN(t);return this._size-=t,this._first=(this._first+t)%this.capacity(),e},i.prototype.enq=function(t){this._end=(this._first+this.size())%this.capacity();var e=this.isFull();return e&&this._evictedCb&&this._evictedCb(this._elements[this._end]),this._elements[this._end]=t,e?this._first=(this._first+1)%this.capacity():this._size++,this.size()},i.prototype.size=function(){return this._size}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Speakers=void 0;var s,n=function(){function t(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,i,s){return i&&t(e.prototype,i),s&&t(e,s),e}}(),r=i(50),o=(s=r)&&s.__esModule?s:{default:s};var h=function(){function t(e){var i=e.onBufferUnderrun;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.onBufferUnderrun=i,this.bufferSize=8192,this.buffer=new o.default(2*this.bufferSize)}return n(t,[{key:"start",value:function(){var t=this;window.AudioContext&&(this.audioCtx=new window.AudioContext,this.scriptNode=this.audioCtx.createScriptProcessor(1024,0,2),this.scriptNode.onaudioprocess=function(e){return t.onaudioprocess(e)},this.scriptNode.connect(this.audioCtx.destination))}},{key:"stop",value:function(){this.scriptNode&&(this.scriptNode.disconnect(this.audioCtx.destination),this.scriptNode.onaudioprocess=null),this.audioCtx&&this.audioCtx.close()}},{key:"writeSample",value:function(t,e){this.buffer.size()/2>=this.bufferSize&&console.log("Buffer overrun"),this.buffer.enq(t),this.buffer.enq(e)}},{key:"onaudioprocess",value:function(t){var e=t.outputBuffer.getChannelData(0),i=t.outputBuffer.getChannelData(1),s=e.length;this.buffer.size()<2*s&&this.onBufferUnderrun&&this.onBufferUnderrun(this.buffer.size(),2*s);try{var n=this.buffer.deqN(2*s)}catch(t){var r=this.buffer.size()/2;r>0&&console.log("Buffer underrun (needed "+s+", got "+r+")");for(var o=0;o<s;o++)e[o]=0,i[o]=0;return}for(var h=0;h<s;h++)e[h]=n[2*h],i[h]=n[2*h+1]}}]),t}();e.Speakers=h},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.MasterSync=void 0;var s=function(){function t(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,i,s){return i&&t(e.prototype,i),s&&t(e,s),e}}(),n=function t(e,i,s){null===e&&(e=Function.prototype);var n=Object.getOwnPropertyDescriptor(e,i);if(void 0===n){var r=Object.getPrototypeOf(e);return null===r?void 0:t(r,i,s)}if("value"in n)return n.value;var o=n.get;return void 0!==o?o.call(s):void 0},r=i(15),o=i(23),h=i(22);var a=function(t){function e(t,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var s=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i));return s.nes=new r.NES({onFrame:function(t){return s.setFrameBuffer(t)},onAudioSample:function(t,e){return s.speakersWriteSample(t,e)},onStatusUpdate:console.log,emulateSound:!0}),s}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,h.SyncBase),s(e,[{key:"start",value:function(t){this.nes.loadROM(t),n(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"start",this).call(this)}},{key:"buttonDown",value:function(t){n(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"buttonDown",this).call(this,t),this.nes.buttonDown(1,t)}},{key:"buttonUp",value:function(t){n(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"buttonUp",this).call(this,t),this.nes.buttonUp(1,t)}},{key:"handleEvent",value:function(t){n(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"handleEvent",this).call(this,t);var i=JSON.parse(t);"buttonDown"===i.code?this.nes.buttonDown(2,i.data.button):"buttonUp"===i.code&&this.nes.buttonUp(2,i.data.button)}},{key:"frame",value:function(t){this.nes.frame(),n(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"frame",this).call(this,t)}},{key:"speakersBufferUnderrun",value:function(t,i){n(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"speakersBufferUnderrun",this).call(this,t,i),this.nes.frame(),this.speakers.buffer.size()<i&&this.nes.frame()}},{key:"setFrameBuffer",value:function(t){n(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setFrameBuffer",this).call(this,t),this.sendPeerFame(t)}},{key:"sendPeerFame",value:function(t){for(var i=(new o.RLECompression).encode(t),s=32*i.length,r=Math.ceil(s/131072),h=0;h<r;h++){var a=i.slice(4096*h,4096*(h+1));h===r-1&&(a[a.length-1]=16777216|a[a.length-1]);var u=Uint32Array.from(a);n(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"dataChannel",this).send(u)}}}]),e}();e.MasterSync=a},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,i,s){return i&&t(e.prototype,i),s&&t(e,s),e}}();var n="551c6238-ec82-4c12-aa4c-1ba8c8a9dd3d",r="1.0",o=function(t){function e(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),t=t||{};var i=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,Photon.ConnectionProtocol.Wss,n,r));return i.onRoomListChange=t.onRoomListChange,i.onUserConnected=t.onUserConnected,i.onEventReceived=t.onEventReceived,i.logger=new Exitgames.Common.Logger("Demo:"),i.output(i.logger.format("Init",i.getNameServerAddress(),n,r)),i.logger.info("Init",i.getNameServerAddress(),n,r),i.setLogLevel(Exitgames.Common.Logger.Level.INFO),i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,Photon.LoadBalancing.LoadBalancingClient),s(e,[{key:"start",value:function(){this.connectToRegionMaster("EU")}},{key:"onError",value:function(t,e){this.output("Error "+t+": "+e)}},{key:"onEvent",value:function(t,e,i){this.onEventReceived&&this.onEventReceived(t,e,i)}},{key:"sendMessage",value:function(t,e){this.raiseEvent(t,e,{})}},{key:"onStateChange",value:function(t){this.output("Change state "+Photon.LoadBalancing.LoadBalancingClient.StateToName(t))}},{key:"onActorPropertiesChange",value:function(t){this.logger.debug("onActorPropertiesChange","actor:",t)}},{key:"onMyRoomPropertiesChange",value:function(){this.logger.debug("onMyRoomPropertiesChange")}},{key:"onRoomListUpdate",value:function(t,e,i,s){this.onRoomListChange&&this.onRoomListChange(t.map(function(t){return{id:t.name}}))}},{key:"onJoinRoom",value:function(){this.output("Game "+this.myRoom().name+" joined")}},{key:"onActorJoin",value:function(t){this.myActor().actorNr!==t.actorNr&&this.onUserConnected&&this.onUserConnected({id:t.actorNr})}},{key:"onActorLeave",value:function(t){this.output("actor "+t.actorNr+" left")}},{key:"output",value:function(t){console.log("Photon output: "+t)}}]),e}();e.MultiplayerClient=o},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.InputBase=function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.onButtonDown=e.onButtonDown,this.onButtonUp=e.onButtonUp}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.KeyboardInput=void 0;var s=function(){function t(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,i,s){return i&&t(e.prototype,i),s&&t(e,s),e}}(),n=i(15),r=i(54);var o={102:[1,n.Controller.BUTTON_A],101:[1,n.Controller.BUTTON_B],16:[1,n.Controller.BUTTON_SELECT],13:[1,n.Controller.BUTTON_START],87:[1,n.Controller.BUTTON_UP],83:[1,n.Controller.BUTTON_DOWN],65:[1,n.Controller.BUTTON_LEFT],68:[1,n.Controller.BUTTON_RIGHT]},h=function(t){function e(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var i=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return document.addEventListener("keydown",function(t){return i.handleKeyDown(t)}),document.addEventListener("keyup",function(t){return i.handleKeyUp(t)}),document.addEventListener("keypress",function(t){return i.handleKeyPress(t)}),i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,r.InputBase),s(e,[{key:"handleKeyDown",value:function(t){var e=o[t.keyCode];e&&(this.onButtonDown(e[0],e[1]),t.preventDefault())}},{key:"handleKeyUp",value:function(t){var e=o[t.keyCode];e&&(this.onButtonUp(e[0],e[1]),t.preventDefault())}},{key:"handleKeyPress",value:function(t){t.preventDefault()}}]),e}();e.KeyboardInput=h},function(t,e,i){var s=i(14),n={0:function(t){this.nes=t}};n[0].prototype={reset:function(){this.joy1StrobeState=0,this.joy2StrobeState=0,this.joypadLastWrite=0,this.zapperFired=!1,this.zapperX=null,this.zapperY=null},write:function(t,e){t<8192?this.nes.cpu.mem[2047&t]=e:t>16407?(this.nes.cpu.mem[t]=e,t>=24576&&t<32768&&(console.log("onBatteryRamWrite",t.toString(16),e.toString(16)),this.nes.opts.onBatteryRamWrite(t,e))):t>8199&&t<16384?this.regWrite(8192+(7&t),e):this.regWrite(t,e)},writelow:function(t,e){t<8192?this.nes.cpu.mem[2047&t]=e:t>16407?this.nes.cpu.mem[t]=e:t>8199&&t<16384?this.regWrite(8192+(7&t),e):this.regWrite(t,e)},load:function(t){return(t&=65535)>16407?this.nes.cpu.mem[t]:t>=8192?this.regLoad(t):this.nes.cpu.mem[2047&t]},regLoad:function(t){switch(t>>12){case 0:case 1:break;case 2:case 3:switch(7&t){case 0:return this.nes.cpu.mem[8192];case 1:return this.nes.cpu.mem[8193];case 2:return this.nes.ppu.readStatusRegister();case 3:return 0;case 4:return this.nes.ppu.sramLoad();case 5:case 6:return 0;case 7:return this.nes.ppu.vramLoad()}break;case 4:switch(t-16405){case 0:return this.nes.papu.readReg(t);case 1:return this.joy1Read();case 2:var e;return e=null!==this.zapperX&&null!==this.zapperY&&this.nes.ppu.isPixelWhite(this.zapperX,this.zapperY)?0:8,this.zapperFired&&(e|=16),65535&(this.joy2Read()|e)}}return 0},regWrite:function(t,e){switch(t){case 8192:this.nes.cpu.mem[t]=e,this.nes.ppu.updateControlReg1(e);break;case 8193:this.nes.cpu.mem[t]=e,this.nes.ppu.updateControlReg2(e);break;case 8195:this.nes.ppu.writeSRAMAddress(e);break;case 8196:this.nes.ppu.sramWrite(e);break;case 8197:this.nes.ppu.scrollWrite(e);break;case 8198:this.nes.ppu.writeVRAMAddress(e);break;case 8199:this.nes.ppu.vramWrite(e);break;case 16404:this.nes.ppu.sramDMA(e);break;case 16405:this.nes.papu.writeReg(t,e);break;case 16406:0==(1&e)&&1==(1&this.joypadLastWrite)&&(this.joy1StrobeState=0,this.joy2StrobeState=0),this.joypadLastWrite=e;break;case 16407:this.nes.papu.writeReg(t,e);break;default:t>=16384&&t<=16407&&this.nes.papu.writeReg(t,e)}},joy1Read:function(){var t;switch(this.joy1StrobeState){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:t=this.nes.controllers[1].state[this.joy1StrobeState];break;case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:case 16:case 17:case 18:t=0;break;case 19:t=1;break;default:t=0}return this.joy1StrobeState++,24===this.joy1StrobeState&&(this.joy1StrobeState=0),t},joy2Read:function(){var t;switch(this.joy2StrobeState){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:t=this.nes.controllers[2].state[this.joy2StrobeState];break;case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:case 16:case 17:case 18:t=0;break;case 19:t=1;break;default:t=0}return this.joy2StrobeState++,24===this.joy2StrobeState&&(this.joy2StrobeState=0),t},loadROM:function(){if(!this.nes.rom.valid||this.nes.rom.romCount<1)throw new Error("NoMapper: Invalid ROM! Unable to load.");this.loadPRGROM(),this.loadCHRROM(),this.loadBatteryRam(),this.nes.cpu.requestIrq(this.nes.cpu.IRQ_RESET)},loadPRGROM:function(){this.nes.rom.romCount>1?(this.loadRomBank(0,32768),this.loadRomBank(1,49152)):(this.loadRomBank(0,32768),this.loadRomBank(0,49152))},loadCHRROM:function(){this.nes.rom.vromCount>0&&(1===this.nes.rom.vromCount?(this.loadVromBank(0,0),this.loadVromBank(0,4096)):(this.loadVromBank(0,0),this.loadVromBank(1,4096)))},loadBatteryRam:function(){if(this.nes.rom.batteryRam){var t=this.nes.rom.batteryRam;null!==t&&8192===t.length&&s.copyArrayElements(t,0,this.nes.cpu.mem,24576,8192)}},loadRomBank:function(t,e){t%=this.nes.rom.romCount,s.copyArrayElements(this.nes.rom.rom[t],0,this.nes.cpu.mem,e,16384)},loadVromBank:function(t,e){if(0!==this.nes.rom.vromCount){this.nes.ppu.triggerRendering(),s.copyArrayElements(this.nes.rom.vrom[t%this.nes.rom.vromCount],0,this.nes.ppu.vramMem,e,4096);var i=this.nes.rom.vromTile[t%this.nes.rom.vromCount];s.copyArrayElements(i,0,this.nes.ppu.ptTile,e>>4,256)}},load32kRomBank:function(t,e){this.loadRomBank(2*t%this.nes.rom.romCount,e),this.loadRomBank((2*t+1)%this.nes.rom.romCount,e+16384)},load8kVromBank:function(t,e){0!==this.nes.rom.vromCount&&(this.nes.ppu.triggerRendering(),this.loadVromBank(t%this.nes.rom.vromCount,e),this.loadVromBank((t+1)%this.nes.rom.vromCount,e+4096))},load1kVromBank:function(t,e){if(0!==this.nes.rom.vromCount){this.nes.ppu.triggerRendering();var i=Math.floor(t/4)%this.nes.rom.vromCount,n=t%4*1024;s.copyArrayElements(this.nes.rom.vrom[i],0,this.nes.ppu.vramMem,n,1024);for(var r=this.nes.rom.vromTile[i],o=e>>4,h=0;h<64;h++)this.nes.ppu.ptTile[o+h]=r[(t%4<<6)+h]}},load2kVromBank:function(t,e){if(0!==this.nes.rom.vromCount){this.nes.ppu.triggerRendering();var i=Math.floor(t/2)%this.nes.rom.vromCount,n=t%2*2048;s.copyArrayElements(this.nes.rom.vrom[i],n,this.nes.ppu.vramMem,e,2048);for(var r=this.nes.rom.vromTile[i],o=e>>4,h=0;h<128;h++)this.nes.ppu.ptTile[o+h]=r[(t%2<<7)+h]}},load8kRomBank:function(t,e){var i=Math.floor(t/2)%this.nes.rom.romCount,n=t%2*8192;s.copyArrayElements(this.nes.rom.rom[i],n,this.nes.cpu.mem,e,8192)},clockIrqCounter:function(){},latchAccess:function(t){},toJSON:function(){return{joy1StrobeState:this.joy1StrobeState,joy2StrobeState:this.joy2StrobeState,joypadLastWrite:this.joypadLastWrite}},fromJSON:function(t){this.joy1StrobeState=t.joy1StrobeState,this.joy2StrobeState=t.joy2StrobeState,this.joypadLastWrite=t.joypadLastWrite}},n[1]=function(t){this.nes=t},n[1].prototype=new n[0],n[1].prototype.reset=function(){n[0].prototype.reset.apply(this),this.regBuffer=0,this.regBufferCounter=0,this.mirroring=0,this.oneScreenMirroring=0,this.prgSwitchingArea=1,this.prgSwitchingSize=1,this.vromSwitchingSize=0,this.romSelectionReg0=0,this.romSelectionReg1=0,this.romBankSelect=0},n[1].prototype.write=function(t,e){t<32768?n[0].prototype.write.apply(this,arguments):0!=(128&e)?(this.regBufferCounter=0,this.regBuffer=0,0===this.getRegNumber(t)&&(this.prgSwitchingArea=1,this.prgSwitchingSize=1)):(this.regBuffer=this.regBuffer&255-(1<<this.regBufferCounter)|(1&e)<<this.regBufferCounter,this.regBufferCounter++,5===this.regBufferCounter&&(this.setReg(this.getRegNumber(t),this.regBuffer),this.regBuffer=0,this.regBufferCounter=0))},n[1].prototype.setReg=function(t,e){var i;switch(t){case 0:(i=3&e)!==this.mirroring&&(this.mirroring=i,0==(2&this.mirroring)?this.nes.ppu.setMirroring(this.nes.rom.SINGLESCREEN_MIRRORING):0!=(1&this.mirroring)?this.nes.ppu.setMirroring(this.nes.rom.HORIZONTAL_MIRRORING):this.nes.ppu.setMirroring(this.nes.rom.VERTICAL_MIRRORING)),this.prgSwitchingArea=e>>2&1,this.prgSwitchingSize=e>>3&1,this.vromSwitchingSize=e>>4&1;break;case 1:this.romSelectionReg0=e>>4&1,this.nes.rom.vromCount>0&&(0===this.vromSwitchingSize?0===this.romSelectionReg0?this.load8kVromBank(15&e,0):this.load8kVromBank(Math.floor(this.nes.rom.vromCount/2)+(15&e),0):0===this.romSelectionReg0?this.loadVromBank(15&e,0):this.loadVromBank(Math.floor(this.nes.rom.vromCount/2)+(15&e),0));break;case 2:this.romSelectionReg1=e>>4&1,this.nes.rom.vromCount>0&&1===this.vromSwitchingSize&&(0===this.romSelectionReg1?this.loadVromBank(15&e,4096):this.loadVromBank(Math.floor(this.nes.rom.vromCount/2)+(15&e),4096));break;default:var s;i=15&e;var n=0;this.nes.rom.romCount>=32?0===this.vromSwitchingSize?1===this.romSelectionReg0&&(n=16):n=(this.romSelectionReg0|this.romSelectionReg1<<1)<<3:this.nes.rom.romCount>=16&&1===this.romSelectionReg0&&(n=8),0===this.prgSwitchingSize?(s=n+(15&e),this.load32kRomBank(s,32768)):(s=2*n+(15&e),0===this.prgSwitchingArea?this.loadRomBank(s,49152):this.loadRomBank(s,32768))}},n[1].prototype.getRegNumber=function(t){return t>=32768&&t<=40959?0:t>=40960&&t<=49151?1:t>=49152&&t<=57343?2:3},n[1].prototype.loadROM=function(){if(!this.nes.rom.valid)throw new Error("MMC1: Invalid ROM! Unable to load.");this.loadRomBank(0,32768),this.loadRomBank(this.nes.rom.romCount-1,49152),this.loadCHRROM(),this.loadBatteryRam(),this.nes.cpu.requestIrq(this.nes.cpu.IRQ_RESET)},n[1].prototype.switchLowHighPrgRom=function(t){},n[1].prototype.switch16to32=function(){},n[1].prototype.switch32to16=function(){},n[1].prototype.toJSON=function(){var t=n[0].prototype.toJSON.apply(this);return t.mirroring=this.mirroring,t.oneScreenMirroring=this.oneScreenMirroring,t.prgSwitchingArea=this.prgSwitchingArea,t.prgSwitchingSize=this.prgSwitchingSize,t.vromSwitchingSize=this.vromSwitchingSize,t.romSelectionReg0=this.romSelectionReg0,t.romSelectionReg1=this.romSelectionReg1,t.romBankSelect=this.romBankSelect,t.regBuffer=this.regBuffer,t.regBufferCounter=this.regBufferCounter,t},n[1].prototype.fromJSON=function(t){n[0].prototype.fromJSON.apply(this,arguments),this.mirroring=t.mirroring,this.oneScreenMirroring=t.oneScreenMirroring,this.prgSwitchingArea=t.prgSwitchingArea,this.prgSwitchingSize=t.prgSwitchingSize,this.vromSwitchingSize=t.vromSwitchingSize,this.romSelectionReg0=t.romSelectionReg0,this.romSelectionReg1=t.romSelectionReg1,this.romBankSelect=t.romBankSelect,this.regBuffer=t.regBuffer,this.regBufferCounter=t.regBufferCounter},n[2]=function(t){this.nes=t},n[2].prototype=new n[0],n[2].prototype.write=function(t,e){t<32768?n[0].prototype.write.apply(this,arguments):this.loadRomBank(e,32768)},n[2].prototype.loadROM=function(){if(!this.nes.rom.valid)throw new Error("UNROM: Invalid ROM! Unable to load.");this.loadRomBank(0,32768),this.loadRomBank(this.nes.rom.romCount-1,49152),this.loadCHRROM(),this.nes.cpu.requestIrq(this.nes.cpu.IRQ_RESET)},n[3]=function(t){this.nes=t},n[3].prototype=new n[0],n[3].prototype.write=function(t,e){if(t<32768)n[0].prototype.write.apply(this,arguments);else{var i=e%(this.nes.rom.vromCount/2)*2;this.loadVromBank(i,0),this.loadVromBank(i+1,4096),this.load8kVromBank(2*e,0)}},n[4]=function(t){this.nes=t,this.CMD_SEL_2_1K_VROM_0000=0,this.CMD_SEL_2_1K_VROM_0800=1,this.CMD_SEL_1K_VROM_1000=2,this.CMD_SEL_1K_VROM_1400=3,this.CMD_SEL_1K_VROM_1800=4,this.CMD_SEL_1K_VROM_1C00=5,this.CMD_SEL_ROM_PAGE1=6,this.CMD_SEL_ROM_PAGE2=7,this.command=null,this.prgAddressSelect=null,this.chrAddressSelect=null,this.pageNumber=null,this.irqCounter=null,this.irqLatchValue=null,this.irqEnable=null,this.prgAddressChanged=!1},n[4].prototype=new n[0],n[4].prototype.write=function(t,e){if(t<32768)n[0].prototype.write.apply(this,arguments);else switch(t){case 32768:this.command=7&e;var i=e>>6&1;i!==this.prgAddressSelect&&(this.prgAddressChanged=!0),this.prgAddressSelect=i,this.chrAddressSelect=e>>7&1;break;case 32769:this.executeCommand(this.command,e);break;case 40960:0!=(1&e)?this.nes.ppu.setMirroring(this.nes.rom.HORIZONTAL_MIRRORING):this.nes.ppu.setMirroring(this.nes.rom.VERTICAL_MIRRORING);break;case 40961:break;case 49152:this.irqCounter=e;break;case 49153:this.irqLatchValue=e;break;case 57344:this.irqEnable=0;break;case 57345:this.irqEnable=1}},n[4].prototype.executeCommand=function(t,e){switch(t){case this.CMD_SEL_2_1K_VROM_0000:0===this.chrAddressSelect?(this.load1kVromBank(e,0),this.load1kVromBank(e+1,1024)):(this.load1kVromBank(e,4096),this.load1kVromBank(e+1,5120));break;case this.CMD_SEL_2_1K_VROM_0800:0===this.chrAddressSelect?(this.load1kVromBank(e,2048),this.load1kVromBank(e+1,3072)):(this.load1kVromBank(e,6144),this.load1kVromBank(e+1,7168));break;case this.CMD_SEL_1K_VROM_1000:0===this.chrAddressSelect?this.load1kVromBank(e,4096):this.load1kVromBank(e,0);break;case this.CMD_SEL_1K_VROM_1400:0===this.chrAddressSelect?this.load1kVromBank(e,5120):this.load1kVromBank(e,1024);break;case this.CMD_SEL_1K_VROM_1800:0===this.chrAddressSelect?this.load1kVromBank(e,6144):this.load1kVromBank(e,2048);break;case this.CMD_SEL_1K_VROM_1C00:0===this.chrAddressSelect?this.load1kVromBank(e,7168):this.load1kVromBank(e,3072);break;case this.CMD_SEL_ROM_PAGE1:this.prgAddressChanged&&(0===this.prgAddressSelect?this.load8kRomBank(2*(this.nes.rom.romCount-1),49152):this.load8kRomBank(2*(this.nes.rom.romCount-1),32768),this.prgAddressChanged=!1),0===this.prgAddressSelect?this.load8kRomBank(e,32768):this.load8kRomBank(e,49152);break;case this.CMD_SEL_ROM_PAGE2:this.load8kRomBank(e,40960),this.prgAddressChanged&&(0===this.prgAddressSelect?this.load8kRomBank(2*(this.nes.rom.romCount-1),49152):this.load8kRomBank(2*(this.nes.rom.romCount-1),32768),this.prgAddressChanged=!1)}},n[4].prototype.loadROM=function(){if(!this.nes.rom.valid)throw new Error("MMC3: Invalid ROM! Unable to load.");this.load8kRomBank(2*(this.nes.rom.romCount-1),49152),this.load8kRomBank(2*(this.nes.rom.romCount-1)+1,57344),this.load8kRomBank(0,32768),this.load8kRomBank(1,40960),this.loadCHRROM(),this.loadBatteryRam(),this.nes.cpu.requestIrq(this.nes.cpu.IRQ_RESET)},n[4].prototype.clockIrqCounter=function(){1===this.irqEnable&&(this.irqCounter--,this.irqCounter<0&&(this.nes.cpu.requestIrq(this.nes.cpu.IRQ_NORMAL),this.irqCounter=this.irqLatchValue))},n[4].prototype.toJSON=function(){var t=n[0].prototype.toJSON.apply(this);return t.command=this.command,t.prgAddressSelect=this.prgAddressSelect,t.chrAddressSelect=this.chrAddressSelect,t.pageNumber=this.pageNumber,t.irqCounter=this.irqCounter,t.irqLatchValue=this.irqLatchValue,t.irqEnable=this.irqEnable,t.prgAddressChanged=this.prgAddressChanged,t},n[4].prototype.fromJSON=function(t){n[0].prototype.fromJSON.apply(this,arguments),this.command=t.command,this.prgAddressSelect=t.prgAddressSelect,this.chrAddressSelect=t.chrAddressSelect,this.pageNumber=t.pageNumber,this.irqCounter=t.irqCounter,this.irqLatchValue=t.irqLatchValue,this.irqEnable=t.irqEnable,this.prgAddressChanged=t.prgAddressChanged},n[5]=function(t){this.nes=t},n[5].prototype=new n[0],n[5].prototype.write=function(t,e){t<32768?n[0].prototype.write.apply(this,arguments):this.load8kVromBank(e,0)},n[5].prototype.write=function(t,e){if(t<20480)n[0].prototype.write.apply(this,arguments);else switch(t){case 20736:this.prg_size=3&e;break;case 20737:this.chr_size=3&e;break;case 20738:this.sram_we_a=3&e;break;case 20739:this.sram_we_b=3&e;break;case 20740:this.graphic_mode=3&e;break;case 20741:this.nametable_mode=e,this.nametable_type[0]=3&e,this.load1kVromBank(3&e,8192),e>>=2,this.nametable_type[1]=3&e,this.load1kVromBank(3&e,9216),e>>=2,this.nametable_type[2]=3&e,this.load1kVromBank(3&e,10240),e>>=2,this.nametable_type[3]=3&e,this.load1kVromBank(3&e,11264);break;case 20742:this.fill_chr=e;break;case 20743:this.fill_pal=3&e;break;case 20755:this.SetBank_SRAM(3,3&e);break;case 20756:case 20757:case 20758:case 20759:this.SetBank_CPU(t,e);break;case 20768:case 20769:case 20770:case 20771:case 20772:case 20773:case 20774:case 20775:this.chr_mode=0,this.chr_page[0][7&t]=e,this.SetBank_PPU();break;case 20776:case 20777:case 20778:case 20779:this.chr_mode=1,this.chr_page[1][0+(3&t)]=e,this.chr_page[1][4+(3&t)]=e,this.SetBank_PPU();break;case 20992:this.split_control=e;break;case 20993:this.split_scroll=e;break;case 20994:this.split_page=63&e;break;case 20995:this.irq_line=e,this.nes.cpu.ClearIRQ();break;case 20996:this.irq_enable=e,this.nes.cpu.ClearIRQ();break;case 20997:this.mult_a=e;break;case 20998:this.mult_b=e;break;default:t>=20480&&t<=20501?this.nes.papu.exWrite(t,e):t>=23552&&t<=24575?2===this.graphic_mode||3!==this.graphic_mode&&this.irq_status:t>=24576&&t<=32767&&2===this.sram_we_a&&this.sram_we_b}},n[5].prototype.loadROM=function(){if(!this.nes.rom.valid)throw new Error("UNROM: Invalid ROM! Unable to load.");this.load8kRomBank(2*this.nes.rom.romCount-1,32768),this.load8kRomBank(2*this.nes.rom.romCount-1,40960),this.load8kRomBank(2*this.nes.rom.romCount-1,49152),this.load8kRomBank(2*this.nes.rom.romCount-1,57344),this.loadCHRROM(),this.nes.cpu.requestIrq(this.nes.cpu.IRQ_RESET)},n[7]=function(t){this.nes=t},n[7].prototype=new n[0],n[7].prototype.write=function(t,e){t<32768?n[0].prototype.write.apply(this,arguments):(this.load32kRomBank(7&e,32768),16&e?this.nes.ppu.setMirroring(this.nes.rom.SINGLESCREEN_MIRRORING2):this.nes.ppu.setMirroring(this.nes.rom.SINGLESCREEN_MIRRORING))},n[7].prototype.loadROM=function(){if(!this.nes.rom.valid)throw new Error("AOROM: Invalid ROM! Unable to load.");this.loadPRGROM(),this.loadCHRROM(),this.nes.cpu.requestIrq(this.nes.cpu.IRQ_RESET)},n[11]=function(t){this.nes=t},n[11].prototype=new n[0],n[11].prototype.write=function(t,e){if(t<32768)n[0].prototype.write.apply(this,arguments);else{var i=2*(15&e)%this.nes.rom.romCount,s=(2*(15&e)+1)%this.nes.rom.romCount;if(this.loadRomBank(i,32768),this.loadRomBank(s,49152),this.nes.rom.vromCount>0){var r=2*(e>>4)%this.nes.rom.vromCount;this.loadVromBank(r,0),this.loadVromBank(r+1,4096)}}},n[34]=function(t){this.nes=t},n[34].prototype=new n[0],n[34].prototype.write=function(t,e){t<32768?n[0].prototype.write.apply(this,arguments):this.load32kRomBank(e,32768)},n[66]=function(t){this.nes=t,console.log("Mapper 66")},n[66].prototype=new n[0],n[66].prototype.write=function(t,e){t<32768?n[0].prototype.write.apply(this,arguments):(this.load32kRomBank(e>>4&3,32768),this.load8kVromBank(2*(3&e),0))},t.exports=n},function(t,e,i){var s=i(56),n=i(24),r=function(t){this.nes=t,this.mapperName=new Array(92);for(var e=0;e<92;e++)this.mapperName[e]="Unknown Mapper";this.mapperName[0]="Direct Access",this.mapperName[1]="Nintendo MMC1",this.mapperName[2]="UNROM",this.mapperName[3]="CNROM",this.mapperName[4]="Nintendo MMC3",this.mapperName[5]="Nintendo MMC5",this.mapperName[6]="FFE F4xxx",this.mapperName[7]="AOROM",this.mapperName[8]="FFE F3xxx",this.mapperName[9]="Nintendo MMC2",this.mapperName[10]="Nintendo MMC4",this.mapperName[11]="Color Dreams Chip",this.mapperName[12]="FFE F6xxx",this.mapperName[15]="100-in-1 switch",this.mapperName[16]="Bandai chip",this.mapperName[17]="FFE F8xxx",this.mapperName[18]="Jaleco SS8806 chip",this.mapperName[19]="Namcot 106 chip",this.mapperName[20]="Famicom Disk System",this.mapperName[21]="Konami VRC4a",this.mapperName[22]="Konami VRC2a",this.mapperName[23]="Konami VRC2a",this.mapperName[24]="Konami VRC6",this.mapperName[25]="Konami VRC4b",this.mapperName[32]="Irem G-101 chip",this.mapperName[33]="Taito TC0190/TC0350",this.mapperName[34]="32kB ROM switch",this.mapperName[64]="Tengen RAMBO-1 chip",this.mapperName[65]="Irem H-3001 chip",this.mapperName[66]="GNROM switch",this.mapperName[67]="SunSoft3 chip",this.mapperName[68]="SunSoft4 chip",this.mapperName[69]="SunSoft5 FME-7 chip",this.mapperName[71]="Camerica chip",this.mapperName[78]="Irem 74HC161/32-based",this.mapperName[91]="Pirate HK-SF3 chip"};r.prototype={VERTICAL_MIRRORING:0,HORIZONTAL_MIRRORING:1,FOURSCREEN_MIRRORING:2,SINGLESCREEN_MIRRORING:3,SINGLESCREEN_MIRRORING2:4,SINGLESCREEN_MIRRORING3:5,SINGLESCREEN_MIRRORING4:6,CHRROM_MIRRORING:7,header:null,rom:null,vrom:null,vromTile:null,romCount:null,vromCount:null,mirroring:null,batteryRam:null,trainer:null,fourScreen:null,mapperType:null,valid:!1,load:function(t){var e,i,s;if(-1===t.indexOf("NES"))throw new Error("Not a valid NES ROM.");for(this.header=new Array(16),e=0;e<16;e++)this.header[e]=255&t.charCodeAt(e);this.romCount=this.header[4],this.vromCount=2*this.header[5],this.mirroring=0!=(1&this.header[6])?1:0,this.batteryRam=0!=(2&this.header[6]),this.trainer=0!=(4&this.header[6]),this.fourScreen=0!=(8&this.header[6]),this.mapperType=this.header[6]>>4|240&this.header[7];var r=!1;for(e=8;e<16;e++)if(0!==this.header[e]){r=!0;break}r&&(this.mapperType&=15),this.rom=new Array(this.romCount);var o,h,a=16;for(e=0;e<this.romCount;e++){for(this.rom[e]=new Array(16384),i=0;i<16384&&!(a+i>=t.length);i++)this.rom[e][i]=255&t.charCodeAt(a+i);a+=16384}for(this.vrom=new Array(this.vromCount),e=0;e<this.vromCount;e++){for(this.vrom[e]=new Array(4096),i=0;i<4096&&!(a+i>=t.length);i++)this.vrom[e][i]=255&t.charCodeAt(a+i);a+=4096}for(this.vromTile=new Array(this.vromCount),e=0;e<this.vromCount;e++)for(this.vromTile[e]=new Array(256),i=0;i<256;i++)this.vromTile[e][i]=new n;for(s=0;s<this.vromCount;s++)for(e=0;e<4096;e++)o=e>>4,(h=e%16)<8?this.vromTile[s][o].setScanline(h,this.vrom[s][e],this.vrom[s][e+8]):this.vromTile[s][o].setScanline(h-8,this.vrom[s][e-8],this.vrom[s][e]);this.valid=!0},getMirroringType:function(){return this.fourScreen?this.FOURSCREEN_MIRRORING:0===this.mirroring?this.HORIZONTAL_MIRRORING:this.VERTICAL_MIRRORING},getMapperName:function(){return this.mapperType>=0&&this.mapperType<this.mapperName.length?this.mapperName[this.mapperType]:"Unknown Mapper, "+this.mapperType},mapperSupported:function(){return void 0!==s[this.mapperType]},createMapper:function(){if(this.mapperSupported())return new s[this.mapperType](this.nes);throw new Error("This ROM uses a mapper not supported by JSNES: "+this.getMapperName()+"("+this.mapperType+")")}},t.exports=r},function(t,e){var i=function(t){this.nes=t,this.square1=new r(this,!0),this.square2=new r(this,!1),this.triangle=new o(this),this.noise=new n(this),this.dmc=new s(this),this.frameIrqCounter=null,this.frameIrqCounterMax=4,this.initCounter=2048,this.channelEnableValue=null,this.sampleRate=44100,this.lengthLookup=null,this.dmcFreqLookup=null,this.noiseWavelengthLookup=null,this.square_table=null,this.tnd_table=null,this.frameIrqEnabled=!1,this.frameIrqActive=null,this.frameClockNow=null,this.startedPlaying=!1,this.recordOutput=!1,this.initingHardware=!1,this.masterFrameCounter=null,this.derivedFrameCounter=null,this.countSequence=null,this.sampleTimer=null,this.frameTime=null,this.sampleTimerMax=null,this.sampleCount=null,this.triValue=0,this.smpSquare1=null,this.smpSquare2=null,this.smpTriangle=null,this.smpDmc=null,this.accCount=null,this.prevSampleL=0,this.prevSampleR=0,this.smpAccumL=0,this.smpAccumR=0,this.dacRange=0,this.dcValue=0,this.masterVolume=256,this.stereoPosLSquare1=null,this.stereoPosLSquare2=null,this.stereoPosLTriangle=null,this.stereoPosLNoise=null,this.stereoPosLDMC=null,this.stereoPosRSquare1=null,this.stereoPosRSquare2=null,this.stereoPosRTriangle=null,this.stereoPosRNoise=null,this.stereoPosRDMC=null,this.extraCycles=null,this.maxSample=null,this.minSample=null,this.panning=[80,170,100,150,128],this.setPanning(this.panning),this.initLengthLookup(),this.initDmcFrequencyLookup(),this.initNoiseWavelengthLookup(),this.initDACtables();for(var e=0;e<20;e++)16===e?this.writeReg(16400,16):this.writeReg(16384+e,0);this.reset()};i.prototype={reset:function(){this.sampleRate=this.nes.opts.sampleRate,this.sampleTimerMax=Math.floor(1832727040*this.nes.opts.preferredFrameRate/(60*this.sampleRate)),this.frameTime=Math.floor(14915*this.nes.opts.preferredFrameRate/60),this.sampleTimer=0,this.updateChannelEnable(0),this.masterFrameCounter=0,this.derivedFrameCounter=0,this.countSequence=0,this.sampleCount=0,this.initCounter=2048,this.frameIrqEnabled=!1,this.initingHardware=!1,this.resetCounter(),this.square1.reset(),this.square2.reset(),this.triangle.reset(),this.noise.reset(),this.dmc.reset(),this.accCount=0,this.smpSquare1=0,this.smpSquare2=0,this.smpTriangle=0,this.smpDmc=0,this.frameIrqEnabled=!1,this.frameIrqCounterMax=4,this.channelEnableValue=255,this.startedPlaying=!1,this.prevSampleL=0,this.prevSampleR=0,this.smpAccumL=0,this.smpAccumR=0,this.maxSample=-5e5,this.minSample=5e5},readReg:function(t){var e=0;return e|=this.square1.getLengthStatus(),e|=this.square2.getLengthStatus()<<1,e|=this.triangle.getLengthStatus()<<2,e|=this.noise.getLengthStatus()<<3,e|=this.dmc.getLengthStatus()<<4,e|=(this.frameIrqActive&&this.frameIrqEnabled?1:0)<<6,e|=this.dmc.getIrqStatus()<<7,this.frameIrqActive=!1,this.dmc.irqGenerated=!1,65535&e},writeReg:function(t,e){t>=16384&&t<16388?this.square1.writeReg(t,e):t>=16388&&t<16392?this.square2.writeReg(t,e):t>=16392&&t<16396?this.triangle.writeReg(t,e):t>=16396&&t<=16399?this.noise.writeReg(t,e):16400===t?this.dmc.writeReg(t,e):16401===t?this.dmc.writeReg(t,e):16402===t?this.dmc.writeReg(t,e):16403===t?this.dmc.writeReg(t,e):16405===t?(this.updateChannelEnable(e),0!==e&&this.initCounter>0&&(this.initingHardware=!0),this.dmc.writeReg(t,e)):16407===t&&(this.countSequence=e>>7&1,this.masterFrameCounter=0,this.frameIrqActive=!1,this.frameIrqEnabled=0==(e>>6&1),0===this.countSequence?(this.frameIrqCounterMax=4,this.derivedFrameCounter=4):(this.frameIrqCounterMax=5,this.derivedFrameCounter=0,this.frameCounterTick()))},resetCounter:function(){0===this.countSequence?this.derivedFrameCounter=4:this.derivedFrameCounter=0},updateChannelEnable:function(t){this.channelEnableValue=65535&t,this.square1.setEnabled(0!=(1&t)),this.square2.setEnabled(0!=(2&t)),this.triangle.setEnabled(0!=(4&t)),this.noise.setEnabled(0!=(8&t)),this.dmc.setEnabled(0!=(16&t))},clockFrameCounter:function(t){if(this.initCounter>0&&this.initingHardware)return this.initCounter-=t,void(this.initCounter<=0&&(this.initingHardware=!1));t+=this.extraCycles;var e=this.sampleTimerMax-this.sampleTimer;t<<10>e?(this.extraCycles=(t<<10)-e>>10,t-=this.extraCycles):this.extraCycles=0;var i=this.dmc,s=this.triangle,n=this.square1,r=this.square2,o=this.noise;if(i.isEnabled)for(i.shiftCounter-=t<<3;i.shiftCounter<=0&&i.dmaFrequency>0;)i.shiftCounter+=i.dmaFrequency,i.clockDmc();if(s.progTimerMax>0)for(s.progTimerCount-=t;s.progTimerCount<=0;)s.progTimerCount+=s.progTimerMax+1,s.linearCounter>0&&s.lengthCounter>0&&(s.triangleCounter++,s.triangleCounter&=31,s.isEnabled&&(s.triangleCounter>=16?s.sampleValue=15&s.triangleCounter:s.sampleValue=15-(15&s.triangleCounter),s.sampleValue<<=4));n.progTimerCount-=t,n.progTimerCount<=0&&(n.progTimerCount+=n.progTimerMax+1<<1,n.squareCounter++,n.squareCounter&=7,n.updateSampleValue()),r.progTimerCount-=t,r.progTimerCount<=0&&(r.progTimerCount+=r.progTimerMax+1<<1,r.squareCounter++,r.squareCounter&=7,r.updateSampleValue());var h=t;if(o.progTimerCount-h>0)o.progTimerCount-=h,o.accCount+=h,o.accValue+=h*o.sampleValue;else for(;h-- >0;)--o.progTimerCount<=0&&o.progTimerMax>0&&(o.shiftReg<<=1,o.tmp=32768&(o.shiftReg<<(0===o.randomMode?1:6)^o.shiftReg),0!==o.tmp?(o.shiftReg|=1,o.randomBit=0,o.sampleValue=0):(o.randomBit=1,o.isEnabled&&o.lengthCounter>0?o.sampleValue=o.masterVolume:o.sampleValue=0),o.progTimerCount+=o.progTimerMax),o.accValue+=o.sampleValue,o.accCount++;this.frameIrqEnabled&&this.frameIrqActive&&this.nes.cpu.requestIrq(this.nes.cpu.IRQ_NORMAL),this.masterFrameCounter+=t<<1,this.masterFrameCounter>=this.frameTime&&(this.masterFrameCounter-=this.frameTime,this.frameCounterTick()),this.accSample(t),this.sampleTimer+=t<<10,this.sampleTimer>=this.sampleTimerMax&&(this.sample(),this.sampleTimer-=this.sampleTimerMax)},accSample:function(t){this.triangle.sampleCondition&&(this.triValue=Math.floor((this.triangle.progTimerCount<<4)/(this.triangle.progTimerMax+1)),this.triValue>16&&(this.triValue=16),this.triangle.triangleCounter>=16&&(this.triValue=16-this.triValue),this.triValue+=this.triangle.sampleValue),2===t?(this.smpTriangle+=this.triValue<<1,this.smpDmc+=this.dmc.sample<<1,this.smpSquare1+=this.square1.sampleValue<<1,this.smpSquare2+=this.square2.sampleValue<<1,this.accCount+=2):4===t?(this.smpTriangle+=this.triValue<<2,this.smpDmc+=this.dmc.sample<<2,this.smpSquare1+=this.square1.sampleValue<<2,this.smpSquare2+=this.square2.sampleValue<<2,this.accCount+=4):(this.smpTriangle+=t*this.triValue,this.smpDmc+=t*this.dmc.sample,this.smpSquare1+=t*this.square1.sampleValue,this.smpSquare2+=t*this.square2.sampleValue,this.accCount+=t)},frameCounterTick:function(){this.derivedFrameCounter++,this.derivedFrameCounter>=this.frameIrqCounterMax&&(this.derivedFrameCounter=0),1!==this.derivedFrameCounter&&3!==this.derivedFrameCounter||(this.triangle.clockLengthCounter(),this.square1.clockLengthCounter(),this.square2.clockLengthCounter(),this.noise.clockLengthCounter(),this.square1.clockSweep(),this.square2.clockSweep()),this.derivedFrameCounter>=0&&this.derivedFrameCounter<4&&(this.square1.clockEnvDecay(),this.square2.clockEnvDecay(),this.noise.clockEnvDecay(),this.triangle.clockLinearCounter()),3===this.derivedFrameCounter&&0===this.countSequence&&(this.frameIrqActive=!0)},sample:function(){var t,e;this.accCount>0?(this.smpSquare1<<=4,this.smpSquare1=Math.floor(this.smpSquare1/this.accCount),this.smpSquare2<<=4,this.smpSquare2=Math.floor(this.smpSquare2/this.accCount),this.smpTriangle=Math.floor(this.smpTriangle/this.accCount),this.smpDmc<<=4,this.smpDmc=Math.floor(this.smpDmc/this.accCount),this.accCount=0):(this.smpSquare1=this.square1.sampleValue<<4,this.smpSquare2=this.square2.sampleValue<<4,this.smpTriangle=this.triangle.sampleValue,this.smpDmc=this.dmc.sample<<4);var i=Math.floor((this.noise.accValue<<4)/this.noise.accCount);this.noise.accValue=i>>4,this.noise.accCount=1,t=this.smpSquare1*this.stereoPosLSquare1+this.smpSquare2*this.stereoPosLSquare2>>8,e=3*this.smpTriangle*this.stereoPosLTriangle+(i<<1)*this.stereoPosLNoise+this.smpDmc*this.stereoPosLDMC>>8,t>=this.square_table.length&&(t=this.square_table.length-1),e>=this.tnd_table.length&&(e=this.tnd_table.length-1);var s=this.square_table[t]+this.tnd_table[e]-this.dcValue;t=this.smpSquare1*this.stereoPosRSquare1+this.smpSquare2*this.stereoPosRSquare2>>8,e=3*this.smpTriangle*this.stereoPosRTriangle+(i<<1)*this.stereoPosRNoise+this.smpDmc*this.stereoPosRDMC>>8,t>=this.square_table.length&&(t=this.square_table.length-1),e>=this.tnd_table.length&&(e=this.tnd_table.length-1);var n=this.square_table[t]+this.tnd_table[e]-this.dcValue,r=s-this.prevSampleL;this.prevSampleL+=r,this.smpAccumL+=r-(this.smpAccumL>>10),s=this.smpAccumL;var o=n-this.prevSampleR;this.prevSampleR+=o,this.smpAccumR+=o-(this.smpAccumR>>10),n=this.smpAccumR,s>this.maxSample&&(this.maxSample=s),s<this.minSample&&(this.minSample=s),this.nes.opts.onAudioSample&&this.nes.opts.onAudioSample(s/32768,n/32768),this.smpSquare1=0,this.smpSquare2=0,this.smpTriangle=0,this.smpDmc=0},getLengthMax:function(t){return this.lengthLookup[t>>3]},getDmcFrequency:function(t){return t>=0&&t<16?this.dmcFreqLookup[t]:0},getNoiseWaveLength:function(t){return t>=0&&t<16?this.noiseWavelengthLookup[t]:0},setPanning:function(t){for(var e=0;e<5;e++)this.panning[e]=t[e];this.updateStereoPos()},setMasterVolume:function(t){t<0&&(t=0),t>256&&(t=256),this.masterVolume=t,this.updateStereoPos()},updateStereoPos:function(){this.stereoPosLSquare1=this.panning[0]*this.masterVolume>>8,this.stereoPosLSquare2=this.panning[1]*this.masterVolume>>8,this.stereoPosLTriangle=this.panning[2]*this.masterVolume>>8,this.stereoPosLNoise=this.panning[3]*this.masterVolume>>8,this.stereoPosLDMC=this.panning[4]*this.masterVolume>>8,this.stereoPosRSquare1=this.masterVolume-this.stereoPosLSquare1,this.stereoPosRSquare2=this.masterVolume-this.stereoPosLSquare2,this.stereoPosRTriangle=this.masterVolume-this.stereoPosLTriangle,this.stereoPosRNoise=this.masterVolume-this.stereoPosLNoise,this.stereoPosRDMC=this.masterVolume-this.stereoPosLDMC},initLengthLookup:function(){this.lengthLookup=[10,254,20,2,40,4,80,6,160,8,60,10,14,12,26,14,12,16,24,18,48,20,96,22,192,24,72,26,16,28,32,30]},initDmcFrequencyLookup:function(){this.dmcFreqLookup=new Array(16),this.dmcFreqLookup[0]=3424,this.dmcFreqLookup[1]=3040,this.dmcFreqLookup[2]=2720,this.dmcFreqLookup[3]=2560,this.dmcFreqLookup[4]=2288,this.dmcFreqLookup[5]=2032,this.dmcFreqLookup[6]=1808,this.dmcFreqLookup[7]=1712,this.dmcFreqLookup[8]=1520,this.dmcFreqLookup[9]=1280,this.dmcFreqLookup[10]=1136,this.dmcFreqLookup[11]=1024,this.dmcFreqLookup[12]=848,this.dmcFreqLookup[13]=672,this.dmcFreqLookup[14]=576,this.dmcFreqLookup[15]=432},initNoiseWavelengthLookup:function(){this.noiseWavelengthLookup=new Array(16),this.noiseWavelengthLookup[0]=4,this.noiseWavelengthLookup[1]=8,this.noiseWavelengthLookup[2]=16,this.noiseWavelengthLookup[3]=32,this.noiseWavelengthLookup[4]=64,this.noiseWavelengthLookup[5]=96,this.noiseWavelengthLookup[6]=128,this.noiseWavelengthLookup[7]=160,this.noiseWavelengthLookup[8]=202,this.noiseWavelengthLookup[9]=254,this.noiseWavelengthLookup[10]=380,this.noiseWavelengthLookup[11]=508,this.noiseWavelengthLookup[12]=762,this.noiseWavelengthLookup[13]=1016,this.noiseWavelengthLookup[14]=2034,this.noiseWavelengthLookup[15]=4068},initDACtables:function(){var t,e,i,s=0,n=0;for(this.square_table=new Array(512),this.tnd_table=new Array(3264),i=0;i<512;i++)t=95.52/(8128/(i/16)+100),t*=.98411,t*=5e4,e=Math.floor(t),this.square_table[i]=e,e>s&&(s=e);for(i=0;i<3264;i++)t=163.67/(24329/(i/16)+100),t*=.98411,t*=5e4,e=Math.floor(t),this.tnd_table[i]=e,e>n&&(n=e);this.dacRange=s+n,this.dcValue=this.dacRange/2}};var s=function(t){this.papu=t,this.MODE_NORMAL=0,this.MODE_LOOP=1,this.MODE_IRQ=2,this.isEnabled=null,this.hasSample=null,this.irqGenerated=!1,this.playMode=null,this.dmaFrequency=null,this.dmaCounter=null,this.deltaCounter=null,this.playStartAddress=null,this.playAddress=null,this.playLength=null,this.playLengthCounter=null,this.shiftCounter=null,this.reg4012=null,this.reg4013=null,this.sample=null,this.dacLsb=null,this.data=null,this.reset()};s.prototype={clockDmc:function(){this.hasSample&&(0==(1&this.data)?this.deltaCounter>0&&this.deltaCounter--:this.deltaCounter<63&&this.deltaCounter++,this.sample=this.isEnabled?(this.deltaCounter<<1)+this.dacLsb:0,this.data>>=1),this.dmaCounter--,this.dmaCounter<=0&&(this.hasSample=!1,this.endOfSample(),this.dmaCounter=8),this.irqGenerated&&this.papu.nes.cpu.requestIrq(this.papu.nes.cpu.IRQ_NORMAL)},endOfSample:function(){0===this.playLengthCounter&&this.playMode===this.MODE_LOOP&&(this.playAddress=this.playStartAddress,this.playLengthCounter=this.playLength),this.playLengthCounter>0&&(this.nextSample(),0===this.playLengthCounter&&this.playMode===this.MODE_IRQ&&(this.irqGenerated=!0))},nextSample:function(){this.data=this.papu.nes.mmap.load(this.playAddress),this.papu.nes.cpu.haltCycles(4),this.playLengthCounter--,this.playAddress++,this.playAddress>65535&&(this.playAddress=32768),this.hasSample=!0},writeReg:function(t,e){16400===t?(e>>6==0?this.playMode=this.MODE_NORMAL:1==(e>>6&1)?this.playMode=this.MODE_LOOP:e>>6==2&&(this.playMode=this.MODE_IRQ),0==(128&e)&&(this.irqGenerated=!1),this.dmaFrequency=this.papu.getDmcFrequency(15&e)):16401===t?(this.deltaCounter=e>>1&63,this.dacLsb=1&e,this.sample=(this.deltaCounter<<1)+this.dacLsb):16402===t?(this.playStartAddress=e<<6|49152,this.playAddress=this.playStartAddress,this.reg4012=e):16403===t?(this.playLength=1+(e<<4),this.playLengthCounter=this.playLength,this.reg4013=e):16405===t&&(0==(e>>4&1)?this.playLengthCounter=0:(this.playAddress=this.playStartAddress,this.playLengthCounter=this.playLength),this.irqGenerated=!1)},setEnabled:function(t){!this.isEnabled&&t&&(this.playLengthCounter=this.playLength),this.isEnabled=t},getLengthStatus:function(){return 0!==this.playLengthCounter&&this.isEnabled?1:0},getIrqStatus:function(){return this.irqGenerated?1:0},reset:function(){this.isEnabled=!1,this.irqGenerated=!1,this.playMode=this.MODE_NORMAL,this.dmaFrequency=0,this.dmaCounter=0,this.deltaCounter=0,this.playStartAddress=0,this.playAddress=0,this.playLength=0,this.playLengthCounter=0,this.sample=0,this.dacLsb=0,this.shiftCounter=0,this.reg4012=0,this.reg4013=0,this.data=0}};var n=function(t){this.papu=t,this.isEnabled=null,this.envDecayDisable=null,this.envDecayLoopEnable=null,this.lengthCounterEnable=null,this.envReset=null,this.shiftNow=null,this.lengthCounter=null,this.progTimerCount=null,this.progTimerMax=null,this.envDecayRate=null,this.envDecayCounter=null,this.envVolume=null,this.masterVolume=null,this.shiftReg=16384,this.randomBit=null,this.randomMode=null,this.sampleValue=null,this.accValue=0,this.accCount=1,this.tmp=null,this.reset()};n.prototype={reset:function(){this.progTimerCount=0,this.progTimerMax=0,this.isEnabled=!1,this.lengthCounter=0,this.lengthCounterEnable=!1,this.envDecayDisable=!1,this.envDecayLoopEnable=!1,this.shiftNow=!1,this.envDecayRate=0,this.envDecayCounter=0,this.envVolume=0,this.masterVolume=0,this.shiftReg=1,this.randomBit=0,this.randomMode=0,this.sampleValue=0,this.tmp=0},clockLengthCounter:function(){this.lengthCounterEnable&&this.lengthCounter>0&&(this.lengthCounter--,0===this.lengthCounter&&this.updateSampleValue())},clockEnvDecay:function(){this.envReset?(this.envReset=!1,this.envDecayCounter=this.envDecayRate+1,this.envVolume=15):--this.envDecayCounter<=0&&(this.envDecayCounter=this.envDecayRate+1,this.envVolume>0?this.envVolume--:this.envVolume=this.envDecayLoopEnable?15:0),this.envDecayDisable?this.masterVolume=this.envDecayRate:this.masterVolume=this.envVolume,this.updateSampleValue()},updateSampleValue:function(){this.isEnabled&&this.lengthCounter>0&&(this.sampleValue=this.randomBit*this.masterVolume)},writeReg:function(t,e){16396===t?(this.envDecayDisable=0!=(16&e),this.envDecayRate=15&e,this.envDecayLoopEnable=0!=(32&e),this.lengthCounterEnable=0==(32&e),this.envDecayDisable?this.masterVolume=this.envDecayRate:this.masterVolume=this.envVolume):16398===t?(this.progTimerMax=this.papu.getNoiseWaveLength(15&e),this.randomMode=e>>7):16399===t&&(this.lengthCounter=this.papu.getLengthMax(248&e),this.envReset=!0)},setEnabled:function(t){this.isEnabled=t,t||(this.lengthCounter=0),this.updateSampleValue()},getLengthStatus:function(){return 0!==this.lengthCounter&&this.isEnabled?1:0}};var r=function(t,e){this.papu=t,this.dutyLookup=[0,1,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,1,1,1,1,0,0,0,1,0,0,1,1,1,1,1],this.impLookup=[1,-1,0,0,0,0,0,0,1,0,-1,0,0,0,0,0,1,0,0,0,-1,0,0,0,-1,0,1,0,0,0,0,0],this.sqr1=e,this.isEnabled=null,this.lengthCounterEnable=null,this.sweepActive=null,this.envDecayDisable=null,this.envDecayLoopEnable=null,this.envReset=null,this.sweepCarry=null,this.updateSweepPeriod=null,this.progTimerCount=null,this.progTimerMax=null,this.lengthCounter=null,this.squareCounter=null,this.sweepCounter=null,this.sweepCounterMax=null,this.sweepMode=null,this.sweepShiftAmount=null,this.envDecayRate=null,this.envDecayCounter=null,this.envVolume=null,this.masterVolume=null,this.dutyMode=null,this.sweepResult=null,this.sampleValue=null,this.vol=null,this.reset()};r.prototype={reset:function(){this.progTimerCount=0,this.progTimerMax=0,this.lengthCounter=0,this.squareCounter=0,this.sweepCounter=0,this.sweepCounterMax=0,this.sweepMode=0,this.sweepShiftAmount=0,this.envDecayRate=0,this.envDecayCounter=0,this.envVolume=0,this.masterVolume=0,this.dutyMode=0,this.vol=0,this.isEnabled=!1,this.lengthCounterEnable=!1,this.sweepActive=!1,this.sweepCarry=!1,this.envDecayDisable=!1,this.envDecayLoopEnable=!1},clockLengthCounter:function(){this.lengthCounterEnable&&this.lengthCounter>0&&(this.lengthCounter--,0===this.lengthCounter&&this.updateSampleValue())},clockEnvDecay:function(){this.envReset?(this.envReset=!1,this.envDecayCounter=this.envDecayRate+1,this.envVolume=15):--this.envDecayCounter<=0&&(this.envDecayCounter=this.envDecayRate+1,this.envVolume>0?this.envVolume--:this.envVolume=this.envDecayLoopEnable?15:0),this.envDecayDisable?this.masterVolume=this.envDecayRate:this.masterVolume=this.envVolume,this.updateSampleValue()},clockSweep:function(){--this.sweepCounter<=0&&(this.sweepCounter=this.sweepCounterMax+1,this.sweepActive&&this.sweepShiftAmount>0&&this.progTimerMax>7&&(this.sweepCarry=!1,0===this.sweepMode?(this.progTimerMax+=this.progTimerMax>>this.sweepShiftAmount,this.progTimerMax>4095&&(this.progTimerMax=4095,this.sweepCarry=!0)):this.progTimerMax=this.progTimerMax-((this.progTimerMax>>this.sweepShiftAmount)-(this.sqr1?1:0)))),this.updateSweepPeriod&&(this.updateSweepPeriod=!1,this.sweepCounter=this.sweepCounterMax+1)},updateSampleValue:function(){this.isEnabled&&this.lengthCounter>0&&this.progTimerMax>7?0===this.sweepMode&&this.progTimerMax+(this.progTimerMax>>this.sweepShiftAmount)>4095?this.sampleValue=0:this.sampleValue=this.masterVolume*this.dutyLookup[(this.dutyMode<<3)+this.squareCounter]:this.sampleValue=0},writeReg:function(t,e){var i=this.sqr1?0:4;t===16384+i?(this.envDecayDisable=0!=(16&e),this.envDecayRate=15&e,this.envDecayLoopEnable=0!=(32&e),this.dutyMode=e>>6&3,this.lengthCounterEnable=0==(32&e),this.envDecayDisable?this.masterVolume=this.envDecayRate:this.masterVolume=this.envVolume,this.updateSampleValue()):t===16385+i?(this.sweepActive=0!=(128&e),this.sweepCounterMax=e>>4&7,this.sweepMode=e>>3&1,this.sweepShiftAmount=7&e,this.updateSweepPeriod=!0):t===16386+i?(this.progTimerMax&=1792,this.progTimerMax|=e):t===16387+i&&(this.progTimerMax&=255,this.progTimerMax|=(7&e)<<8,this.isEnabled&&(this.lengthCounter=this.papu.getLengthMax(248&e)),this.envReset=!0)},setEnabled:function(t){this.isEnabled=t,t||(this.lengthCounter=0),this.updateSampleValue()},getLengthStatus:function(){return 0!==this.lengthCounter&&this.isEnabled?1:0}};var o=function(t){this.papu=t,this.isEnabled=null,this.sampleCondition=null,this.lengthCounterEnable=null,this.lcHalt=null,this.lcControl=null,this.progTimerCount=null,this.progTimerMax=null,this.triangleCounter=null,this.lengthCounter=null,this.linearCounter=null,this.lcLoadValue=null,this.sampleValue=null,this.tmp=null,this.reset()};o.prototype={reset:function(){this.progTimerCount=0,this.progTimerMax=0,this.triangleCounter=0,this.isEnabled=!1,this.sampleCondition=!1,this.lengthCounter=0,this.lengthCounterEnable=!1,this.linearCounter=0,this.lcLoadValue=0,this.lcHalt=!0,this.lcControl=!1,this.tmp=0,this.sampleValue=15},clockLengthCounter:function(){this.lengthCounterEnable&&this.lengthCounter>0&&(this.lengthCounter--,0===this.lengthCounter&&this.updateSampleCondition())},clockLinearCounter:function(){this.lcHalt?(this.linearCounter=this.lcLoadValue,this.updateSampleCondition()):this.linearCounter>0&&(this.linearCounter--,this.updateSampleCondition()),this.lcControl||(this.lcHalt=!1)},getLengthStatus:function(){return 0!==this.lengthCounter&&this.isEnabled?1:0},readReg:function(t){return 0},writeReg:function(t,e){16392===t?(this.lcControl=0!=(128&e),this.lcLoadValue=127&e,this.lengthCounterEnable=!this.lcControl):16394===t?(this.progTimerMax&=1792,this.progTimerMax|=e):16395===t&&(this.progTimerMax&=255,this.progTimerMax|=(7&e)<<8,this.lengthCounter=this.papu.getLengthMax(248&e),this.lcHalt=!0),this.updateSampleCondition()},clockProgrammableTimer:function(t){if(this.progTimerMax>0)for(this.progTimerCount+=t;this.progTimerMax>0&&this.progTimerCount>=this.progTimerMax;)this.progTimerCount-=this.progTimerMax,this.isEnabled&&this.lengthCounter>0&&this.linearCounter>0&&this.clockTriangleGenerator()},clockTriangleGenerator:function(){this.triangleCounter++,this.triangleCounter&=31},setEnabled:function(t){this.isEnabled=t,t||(this.lengthCounter=0),this.updateSampleCondition()},updateSampleCondition:function(){this.sampleCondition=this.isEnabled&&this.progTimerMax>7&&this.linearCounter>0&&this.lengthCounter>0}},t.exports=i},function(t,e,i){var s=i(24),n=i(14),r=function(t){this.nes=t,this.vramMem=null,this.spriteMem=null,this.vramAddress=null,this.vramTmpAddress=null,this.vramBufferedReadValue=null,this.firstWrite=null,this.sramAddress=null,this.currentMirroring=null,this.requestEndFrame=null,this.nmiOk=null,this.dummyCycleToggle=null,this.validTileData=null,this.nmiCounter=null,this.scanlineAlreadyRendered=null,this.f_nmiOnVblank=null,this.f_spriteSize=null,this.f_bgPatternTable=null,this.f_spPatternTable=null,this.f_addrInc=null,this.f_nTblAddress=null,this.f_color=null,this.f_spVisibility=null,this.f_bgVisibility=null,this.f_spClipping=null,this.f_bgClipping=null,this.f_dispType=null,this.cntFV=null,this.cntV=null,this.cntH=null,this.cntVT=null,this.cntHT=null,this.regFV=null,this.regV=null,this.regH=null,this.regVT=null,this.regHT=null,this.regFH=null,this.regS=null,this.curNt=null,this.attrib=null,this.buffer=null,this.bgbuffer=null,this.pixrendered=null,this.validTileData=null,this.scantile=null,this.scanline=null,this.lastRenderedScanline=null,this.curX=null,this.sprX=null,this.sprY=null,this.sprTile=null,this.sprCol=null,this.vertFlip=null,this.horiFlip=null,this.bgPriority=null,this.spr0HitX=null,this.spr0HitY=null,this.hitSpr0=null,this.sprPalette=null,this.imgPalette=null,this.ptTile=null,this.ntable1=null,this.currentMirroring=null,this.nameTable=null,this.vramMirrorTable=null,this.palTable=null,this.showSpr0Hit=!1,this.clipToTvSize=!0,this.reset()};r.prototype={STATUS_VRAMWRITE:4,STATUS_SLSPRITECOUNT:5,STATUS_SPRITE0HIT:6,STATUS_VBLANK:7,reset:function(){var t;for(this.vramMem=new Array(32768),this.spriteMem=new Array(256),t=0;t<this.vramMem.length;t++)this.vramMem[t]=0;for(t=0;t<this.spriteMem.length;t++)this.spriteMem[t]=0;for(this.vramAddress=null,this.vramTmpAddress=null,this.vramBufferedReadValue=0,this.firstWrite=!0,this.sramAddress=0,this.currentMirroring=-1,this.requestEndFrame=!1,this.nmiOk=!1,this.dummyCycleToggle=!1,this.validTileData=!1,this.nmiCounter=0,this.scanlineAlreadyRendered=null,this.f_nmiOnVblank=0,this.f_spriteSize=0,this.f_bgPatternTable=0,this.f_spPatternTable=0,this.f_addrInc=0,this.f_nTblAddress=0,this.f_color=0,this.f_spVisibility=0,this.f_bgVisibility=0,this.f_spClipping=0,this.f_bgClipping=0,this.f_dispType=0,this.cntFV=0,this.cntV=0,this.cntH=0,this.cntVT=0,this.cntHT=0,this.regFV=0,this.regV=0,this.regH=0,this.regVT=0,this.regHT=0,this.regFH=0,this.regS=0,this.curNt=null,this.attrib=new Array(32),this.buffer=new Array(61440),this.bgbuffer=new Array(61440),this.pixrendered=new Array(61440),this.validTileData=null,this.scantile=new Array(32),this.scanline=0,this.lastRenderedScanline=-1,this.curX=0,this.sprX=new Array(64),this.sprY=new Array(64),this.sprTile=new Array(64),this.sprCol=new Array(64),this.vertFlip=new Array(64),this.horiFlip=new Array(64),this.bgPriority=new Array(64),this.spr0HitX=0,this.spr0HitY=0,this.hitSpr0=!1,this.sprPalette=new Array(16),this.imgPalette=new Array(16),this.ptTile=new Array(512),t=0;t<512;t++)this.ptTile[t]=new s;for(this.ntable1=new Array(4),this.currentMirroring=-1,this.nameTable=new Array(4),t=0;t<4;t++)this.nameTable[t]=new o(32,32,"Nt"+t);for(this.vramMirrorTable=new Array(32768),t=0;t<32768;t++)this.vramMirrorTable[t]=t;this.palTable=new h,this.palTable.loadNTSCPalette(),this.updateControlReg1(0),this.updateControlReg2(0)},setMirroring:function(t){if(t!==this.currentMirroring){this.currentMirroring=t,this.triggerRendering(),null===this.vramMirrorTable&&(this.vramMirrorTable=new Array(32768));for(var e=0;e<32768;e++)this.vramMirrorTable[e]=e;this.defineMirrorRegion(16160,16128,32),this.defineMirrorRegion(16192,16128,32),this.defineMirrorRegion(16256,16128,32),this.defineMirrorRegion(16320,16128,32),this.defineMirrorRegion(12288,8192,3840),this.defineMirrorRegion(16384,0,16384),t===this.nes.rom.HORIZONTAL_MIRRORING?(this.ntable1[0]=0,this.ntable1[1]=0,this.ntable1[2]=1,this.ntable1[3]=1,this.defineMirrorRegion(9216,8192,1024),this.defineMirrorRegion(11264,10240,1024)):t===this.nes.rom.VERTICAL_MIRRORING?(this.ntable1[0]=0,this.ntable1[1]=1,this.ntable1[2]=0,this.ntable1[3]=1,this.defineMirrorRegion(10240,8192,1024),this.defineMirrorRegion(11264,9216,1024)):t===this.nes.rom.SINGLESCREEN_MIRRORING?(this.ntable1[0]=0,this.ntable1[1]=0,this.ntable1[2]=0,this.ntable1[3]=0,this.defineMirrorRegion(9216,8192,1024),this.defineMirrorRegion(10240,8192,1024),this.defineMirrorRegion(11264,8192,1024)):t===this.nes.rom.SINGLESCREEN_MIRRORING2?(this.ntable1[0]=1,this.ntable1[1]=1,this.ntable1[2]=1,this.ntable1[3]=1,this.defineMirrorRegion(9216,9216,1024),this.defineMirrorRegion(10240,9216,1024),this.defineMirrorRegion(11264,9216,1024)):(this.ntable1[0]=0,this.ntable1[1]=1,this.ntable1[2]=2,this.ntable1[3]=3)}},defineMirrorRegion:function(t,e,i){for(var s=0;s<i;s++)this.vramMirrorTable[t+s]=e+s},startVBlank:function(){this.nes.cpu.requestIrq(this.nes.cpu.IRQ_NMI),this.lastRenderedScanline<239&&this.renderFramePartially(this.lastRenderedScanline+1,240-this.lastRenderedScanline),this.endFrame(),this.lastRenderedScanline=-1},endScanline:function(){switch(this.scanline){case 19:this.dummyCycleToggle&&(this.curX=1,this.dummyCycleToggle=!this.dummyCycleToggle);break;case 20:this.setStatusFlag(this.STATUS_VBLANK,!1),this.setStatusFlag(this.STATUS_SPRITE0HIT,!1),this.hitSpr0=!1,this.spr0HitX=-1,this.spr0HitY=-1,1!==this.f_bgVisibility&&1!==this.f_spVisibility||(this.cntFV=this.regFV,this.cntV=this.regV,this.cntH=this.regH,this.cntVT=this.regVT,this.cntHT=this.regHT,1===this.f_bgVisibility&&this.renderBgScanline(!1,0)),1===this.f_bgVisibility&&1===this.f_spVisibility&&this.checkSprite0(0),1!==this.f_bgVisibility&&1!==this.f_spVisibility||this.nes.mmap.clockIrqCounter();break;case 261:this.setStatusFlag(this.STATUS_VBLANK,!0),this.requestEndFrame=!0,this.nmiCounter=9,this.scanline=-1;break;default:this.scanline>=21&&this.scanline<=260&&(1===this.f_bgVisibility&&(this.scanlineAlreadyRendered||(this.cntHT=this.regHT,this.cntH=this.regH,this.renderBgScanline(!0,this.scanline+1-21)),this.scanlineAlreadyRendered=!1,this.hitSpr0||1!==this.f_spVisibility||this.sprX[0]>=-7&&this.sprX[0]<256&&this.sprY[0]+1<=this.scanline-20&&this.sprY[0]+1+(0===this.f_spriteSize?8:16)>=this.scanline-20&&this.checkSprite0(this.scanline-20)&&(this.hitSpr0=!0)),1!==this.f_bgVisibility&&1!==this.f_spVisibility||this.nes.mmap.clockIrqCounter())}this.scanline++,this.regsToAddress(),this.cntsToAddress()},startFrame:function(){var t=0;if(0===this.f_dispType)t=this.imgPalette[0];else switch(this.f_color){case 0:t=0;break;case 1:t=65280;break;case 2:t=16711680;break;case 3:t=0;break;case 4:t=255;break;default:t=0}var e,i=this.buffer;for(e=0;e<61440;e++)i[e]=t;var s=this.pixrendered;for(e=0;e<s.length;e++)s[e]=65},endFrame:function(){var t,e,i,s=this.buffer;if(this.showSpr0Hit){if(this.sprX[0]>=0&&this.sprX[0]<256&&this.sprY[0]>=0&&this.sprY[0]<240){for(t=0;t<256;t++)s[(this.sprY[0]<<8)+t]=16733525;for(t=0;t<240;t++)s[(t<<8)+this.sprX[0]]=16733525}if(this.spr0HitX>=0&&this.spr0HitX<256&&this.spr0HitY>=0&&this.spr0HitY<240){for(t=0;t<256;t++)s[(this.spr0HitY<<8)+t]=5635925;for(t=0;t<240;t++)s[(t<<8)+this.spr0HitX]=5635925}}if(this.clipToTvSize||0===this.f_bgClipping||0===this.f_spClipping)for(i=0;i<240;i++)for(e=0;e<8;e++)s[(i<<8)+e]=0;if(this.clipToTvSize)for(i=0;i<240;i++)for(e=0;e<8;e++)s[255+(i<<8)-e]=0;if(this.clipToTvSize)for(i=0;i<8;i++)for(e=0;e<256;e++)s[(i<<8)+e]=0,s[(239-i<<8)+e]=0;this.nes.ui.writeFrame(s)},updateControlReg1:function(t){this.triggerRendering(),this.f_nmiOnVblank=t>>7&1,this.f_spriteSize=t>>5&1,this.f_bgPatternTable=t>>4&1,this.f_spPatternTable=t>>3&1,this.f_addrInc=t>>2&1,this.f_nTblAddress=3&t,this.regV=t>>1&1,this.regH=1&t,this.regS=t>>4&1},updateControlReg2:function(t){this.triggerRendering(),this.f_color=t>>5&7,this.f_spVisibility=t>>4&1,this.f_bgVisibility=t>>3&1,this.f_spClipping=t>>2&1,this.f_bgClipping=t>>1&1,this.f_dispType=1&t,0===this.f_dispType&&this.palTable.setEmphasis(this.f_color),this.updatePalettes()},setStatusFlag:function(t,e){var i=1<<t;this.nes.cpu.mem[8194]=this.nes.cpu.mem[8194]&255-i|(e?i:0)},readStatusRegister:function(){var t=this.nes.cpu.mem[8194];return this.firstWrite=!0,this.setStatusFlag(this.STATUS_VBLANK,!1),t},writeSRAMAddress:function(t){this.sramAddress=t},sramLoad:function(){return this.spriteMem[this.sramAddress]},sramWrite:function(t){this.spriteMem[this.sramAddress]=t,this.spriteRamWriteUpdate(this.sramAddress,t),this.sramAddress++,this.sramAddress%=256},scrollWrite:function(t){this.triggerRendering(),this.firstWrite?(this.regHT=t>>3&31,this.regFH=7&t):(this.regFV=7&t,this.regVT=t>>3&31),this.firstWrite=!this.firstWrite},writeVRAMAddress:function(t){this.firstWrite?(this.regFV=t>>4&3,this.regV=t>>3&1,this.regH=t>>2&1,this.regVT=7&this.regVT|(3&t)<<3):(this.triggerRendering(),this.regVT=24&this.regVT|t>>5&7,this.regHT=31&t,this.cntFV=this.regFV,this.cntV=this.regV,this.cntH=this.regH,this.cntVT=this.regVT,this.cntHT=this.regHT,this.checkSprite0(this.scanline-20)),this.firstWrite=!this.firstWrite,this.cntsToAddress(),this.vramAddress<8192&&this.nes.mmap.latchAccess(this.vramAddress)},vramLoad:function(){var t;return this.cntsToAddress(),this.regsToAddress(),this.vramAddress<=16127?(t=this.vramBufferedReadValue,this.vramAddress<8192?this.vramBufferedReadValue=this.vramMem[this.vramAddress]:this.vramBufferedReadValue=this.mirroredLoad(this.vramAddress),this.vramAddress<8192&&this.nes.mmap.latchAccess(this.vramAddress),this.vramAddress+=1===this.f_addrInc?32:1,this.cntsFromAddress(),this.regsFromAddress(),t):(t=this.mirroredLoad(this.vramAddress),this.vramAddress+=1===this.f_addrInc?32:1,this.cntsFromAddress(),this.regsFromAddress(),t)},vramWrite:function(t){this.triggerRendering(),this.cntsToAddress(),this.regsToAddress(),this.vramAddress>=8192?this.mirroredWrite(this.vramAddress,t):(this.writeMem(this.vramAddress,t),this.nes.mmap.latchAccess(this.vramAddress)),this.vramAddress+=1===this.f_addrInc?32:1,this.regsFromAddress(),this.cntsFromAddress()},sramDMA:function(t){for(var e,i=256*t,s=this.sramAddress;s<256;s++)e=this.nes.cpu.mem[i+s],this.spriteMem[s]=e,this.spriteRamWriteUpdate(s,e);this.nes.cpu.haltCycles(513)},regsFromAddress:function(){var t=this.vramTmpAddress>>8&255;this.regFV=t>>4&7,this.regV=t>>3&1,this.regH=t>>2&1,this.regVT=7&this.regVT|(3&t)<<3,t=255&this.vramTmpAddress,this.regVT=24&this.regVT|t>>5&7,this.regHT=31&t},cntsFromAddress:function(){var t=this.vramAddress>>8&255;this.cntFV=t>>4&3,this.cntV=t>>3&1,this.cntH=t>>2&1,this.cntVT=7&this.cntVT|(3&t)<<3,t=255&this.vramAddress,this.cntVT=24&this.cntVT|t>>5&7,this.cntHT=31&t},regsToAddress:function(){var t=(7&this.regFV)<<4;t|=(1&this.regV)<<3,t|=(1&this.regH)<<2,t|=this.regVT>>3&3;var e=(7&this.regVT)<<5;e|=31&this.regHT,this.vramTmpAddress=32767&(t<<8|e)},cntsToAddress:function(){var t=(7&this.cntFV)<<4;t|=(1&this.cntV)<<3,t|=(1&this.cntH)<<2,t|=this.cntVT>>3&3;var e=(7&this.cntVT)<<5;e|=31&this.cntHT,this.vramAddress=32767&(t<<8|e)},incTileCounter:function(t){for(var e=t;0!==e;e--)this.cntHT++,32===this.cntHT&&(this.cntHT=0,this.cntVT++,this.cntVT>=30&&(this.cntH++,2===this.cntH&&(this.cntH=0,this.cntV++,2===this.cntV&&(this.cntV=0,this.cntFV++,this.cntFV&=7))))},mirroredLoad:function(t){return this.vramMem[this.vramMirrorTable[t]]},mirroredWrite:function(t,e){if(t>=16128&&t<16160)16128===t||16144===t?(this.writeMem(16128,e),this.writeMem(16144,e)):16132===t||16148===t?(this.writeMem(16132,e),this.writeMem(16148,e)):16136===t||16152===t?(this.writeMem(16136,e),this.writeMem(16152,e)):16140===t||16156===t?(this.writeMem(16140,e),this.writeMem(16156,e)):this.writeMem(t,e);else{if(!(t<this.vramMirrorTable.length))throw new Error("Invalid VRAM address: "+t.toString(16));this.writeMem(this.vramMirrorTable[t],e)}},triggerRendering:function(){this.scanline>=21&&this.scanline<=260&&(this.renderFramePartially(this.lastRenderedScanline+1,this.scanline-21-this.lastRenderedScanline),this.lastRenderedScanline=this.scanline-21)},renderFramePartially:function(t,e){if(1===this.f_spVisibility&&this.renderSpritesPartially(t,e,!0),1===this.f_bgVisibility){var i=t<<8,s=t+e<<8;s>61440&&(s=61440);for(var n=this.buffer,r=this.bgbuffer,o=this.pixrendered,h=i;h<s;h++)o[h]>255&&(n[h]=r[h])}1===this.f_spVisibility&&this.renderSpritesPartially(t,e,!1),this.validTileData=!1},renderBgScanline:function(t,e){var i=0===this.regS?0:256,s=(e<<8)-this.regFH;if(this.curNt=this.ntable1[this.cntV+this.cntV+this.cntH],this.cntHT=this.regHT,this.cntH=this.regH,this.curNt=this.ntable1[this.cntV+this.cntV+this.cntH],e<240&&e-this.cntFV>=0){for(var n,r,o,h,a=this.cntFV<<3,u=this.scantile,l=this.attrib,c=this.ptTile,p=this.nameTable,f=this.imgPalette,m=this.pixrendered,d=t?this.bgbuffer:this.buffer,_=0;_<32;_++){if(e>=0){if(this.validTileData){if(void 0===(n=u[_]))continue;r=n.pix,o=l[_]}else{if(void 0===(n=c[i+p[this.curNt].getTileIndex(this.cntHT,this.cntVT)]))continue;r=n.pix,o=p[this.curNt].getAttrib(this.cntHT,this.cntVT),u[_]=n,l[_]=o}var g=0,R=(_<<3)-this.regFH;if(R>-8)if(R<0&&(s-=R,g=-R),n.opaque[this.cntFV])for(;g<8;g++)d[s]=f[r[a+g]+o],m[s]|=256,s++;else for(;g<8;g++)0!==(h=r[a+g])&&(d[s]=f[h+o],m[s]|=256),s++}32==++this.cntHT&&(this.cntHT=0,this.cntH++,this.cntH%=2,this.curNt=this.ntable1[(this.cntV<<1)+this.cntH])}this.validTileData=!0}this.cntFV++,8===this.cntFV&&(this.cntFV=0,this.cntVT++,30===this.cntVT?(this.cntVT=0,this.cntV++,this.cntV%=2,this.curNt=this.ntable1[(this.cntV<<1)+this.cntH]):32===this.cntVT&&(this.cntVT=0),this.validTileData=!1)},renderSpritesPartially:function(t,e,i){if(1===this.f_spVisibility)for(var s=0;s<64;s++)if(this.bgPriority[s]===i&&this.sprX[s]>=0&&this.sprX[s]<256&&this.sprY[s]+8>=t&&this.sprY[s]<t+e)if(0===this.f_spriteSize)this.srcy1=0,this.srcy2=8,this.sprY[s]<t&&(this.srcy1=t-this.sprY[s]-1),this.sprY[s]+8>t+e&&(this.srcy2=t+e-this.sprY[s]+1),0===this.f_spPatternTable?this.ptTile[this.sprTile[s]].render(this.buffer,0,this.srcy1,8,this.srcy2,this.sprX[s],this.sprY[s]+1,this.sprCol[s],this.sprPalette,this.horiFlip[s],this.vertFlip[s],s,this.pixrendered):this.ptTile[this.sprTile[s]+256].render(this.buffer,0,this.srcy1,8,this.srcy2,this.sprX[s],this.sprY[s]+1,this.sprCol[s],this.sprPalette,this.horiFlip[s],this.vertFlip[s],s,this.pixrendered);else{var n=this.sprTile[s];0!=(1&n)&&(n=this.sprTile[s]-1+256);var r=0,o=8;this.sprY[s]<t&&(r=t-this.sprY[s]-1),this.sprY[s]+8>t+e&&(o=t+e-this.sprY[s]),this.ptTile[n+(this.vertFlip[s]?1:0)].render(this.buffer,0,r,8,o,this.sprX[s],this.sprY[s]+1,this.sprCol[s],this.sprPalette,this.horiFlip[s],this.vertFlip[s],s,this.pixrendered),r=0,o=8,this.sprY[s]+8<t&&(r=t-(this.sprY[s]+8+1)),this.sprY[s]+16>t+e&&(o=t+e-(this.sprY[s]+8)),this.ptTile[n+(this.vertFlip[s]?0:1)].render(this.buffer,0,r,8,o,this.sprX[s],this.sprY[s]+1+8,this.sprCol[s],this.sprPalette,this.horiFlip[s],this.vertFlip[s],s,this.pixrendered)}},checkSprite0:function(t){var e;this.spr0HitX=-1,this.spr0HitY=-1;var i,s,n,r,o,h=0===this.f_spPatternTable?0:256;if(i=this.sprX[0],s=this.sprY[0]+1,0===this.f_spriteSize){if(s<=t&&s+8>t&&i>=-7&&i<256)if(n=this.ptTile[this.sprTile[0]+h],this.sprCol[0],this.bgPriority[0],e=this.vertFlip[0]?7-(t-s):t-s,e*=8,o=256*t+i,this.horiFlip[0])for(r=7;r>=0;r--){if(i>=0&&i<256&&o>=0&&o<61440&&0!==this.pixrendered[o]&&0!==n.pix[e+r])return this.spr0HitX=o%256,this.spr0HitY=t,!0;i++,o++}else for(r=0;r<8;r++){if(i>=0&&i<256&&o>=0&&o<61440&&0!==this.pixrendered[o]&&0!==n.pix[e+r])return this.spr0HitX=o%256,this.spr0HitY=t,!0;i++,o++}}else if(s<=t&&s+16>t&&i>=-7&&i<256)if((e=this.vertFlip[0]?15-(t-s):t-s)<8?n=this.ptTile[this.sprTile[0]+(this.vertFlip[0]?1:0)+(0!=(1&this.sprTile[0])?255:0)]:(n=this.ptTile[this.sprTile[0]+(this.vertFlip[0]?0:1)+(0!=(1&this.sprTile[0])?255:0)],this.vertFlip[0]?e=15-e:e-=8),e*=8,this.sprCol[0],this.bgPriority[0],o=256*t+i,this.horiFlip[0])for(r=7;r>=0;r--){if(i>=0&&i<256&&o>=0&&o<61440&&0!==this.pixrendered[o]&&0!==n.pix[e+r])return this.spr0HitX=o%256,this.spr0HitY=t,!0;i++,o++}else for(r=0;r<8;r++){if(i>=0&&i<256&&o>=0&&o<61440&&0!==this.pixrendered[o]&&0!==n.pix[e+r])return this.spr0HitX=o%256,this.spr0HitY=t,!0;i++,o++}return!1},writeMem:function(t,e){this.vramMem[t]=e,t<8192?(this.vramMem[t]=e,this.patternWrite(t,e)):t>=8192&&t<9152?this.nameTableWrite(this.ntable1[0],t-8192,e):t>=9152&&t<9216?this.attribTableWrite(this.ntable1[0],t-9152,e):t>=9216&&t<10176?this.nameTableWrite(this.ntable1[1],t-9216,e):t>=10176&&t<10240?this.attribTableWrite(this.ntable1[1],t-10176,e):t>=10240&&t<11200?this.nameTableWrite(this.ntable1[2],t-10240,e):t>=11200&&t<11264?this.attribTableWrite(this.ntable1[2],t-11200,e):t>=11264&&t<12224?this.nameTableWrite(this.ntable1[3],t-11264,e):t>=12224&&t<12288?this.attribTableWrite(this.ntable1[3],t-12224,e):t>=16128&&t<16160&&this.updatePalettes()},updatePalettes:function(){var t;for(t=0;t<16;t++)0===this.f_dispType?this.imgPalette[t]=this.palTable.getEntry(63&this.vramMem[16128+t]):this.imgPalette[t]=this.palTable.getEntry(32&this.vramMem[16128+t]);for(t=0;t<16;t++)0===this.f_dispType?this.sprPalette[t]=this.palTable.getEntry(63&this.vramMem[16144+t]):this.sprPalette[t]=this.palTable.getEntry(32&this.vramMem[16144+t])},patternWrite:function(t,e){var i=Math.floor(t/16),s=t%16;s<8?this.ptTile[i].setScanline(s,e,this.vramMem[t+8]):this.ptTile[i].setScanline(s-8,this.vramMem[t-8],e)},nameTableWrite:function(t,e,i){this.nameTable[t].tile[e]=i,this.checkSprite0(this.scanline-20)},attribTableWrite:function(t,e,i){this.nameTable[t].writeAttrib(e,i)},spriteRamWriteUpdate:function(t,e){var i=Math.floor(t/4);0===i&&this.checkSprite0(this.scanline-20),t%4==0?this.sprY[i]=e:t%4==1?this.sprTile[i]=e:t%4==2?(this.vertFlip[i]=0!=(128&e),this.horiFlip[i]=0!=(64&e),this.bgPriority[i]=0!=(32&e),this.sprCol[i]=(3&e)<<2):t%4==3&&(this.sprX[i]=e)},doNMI:function(){this.setStatusFlag(this.STATUS_VBLANK,!0),this.nes.cpu.requestIrq(this.nes.cpu.IRQ_NMI)},isPixelWhite:function(t,e){return this.triggerRendering(),16777215===this.nes.ppu.buffer[(e<<8)+t]},JSON_PROPERTIES:["vramMem","spriteMem","cntFV","cntV","cntH","cntVT","cntHT","regFV","regV","regH","regVT","regHT","regFH","regS","vramAddress","vramTmpAddress","f_nmiOnVblank","f_spriteSize","f_bgPatternTable","f_spPatternTable","f_addrInc","f_nTblAddress","f_color","f_spVisibility","f_bgVisibility","f_spClipping","f_bgClipping","f_dispType","vramBufferedReadValue","firstWrite","currentMirroring","vramMirrorTable","ntable1","sramAddress","hitSpr0","sprPalette","imgPalette","curX","scanline","lastRenderedScanline","curNt","scantile","attrib","buffer","bgbuffer","pixrendered","requestEndFrame","nmiOk","dummyCycleToggle","nmiCounter","validTileData","scanlineAlreadyRendered"],toJSON:function(){var t,e=n.toJSON(this);for(e.nameTable=[],t=0;t<this.nameTable.length;t++)e.nameTable[t]=this.nameTable[t].toJSON();for(e.ptTile=[],t=0;t<this.ptTile.length;t++)e.ptTile[t]=this.ptTile[t].toJSON();return e},fromJSON:function(t){var e;for(n.fromJSON(this,t),e=0;e<this.nameTable.length;e++)this.nameTable[e].fromJSON(t.nameTable[e]);for(e=0;e<this.ptTile.length;e++)this.ptTile[e].fromJSON(t.ptTile[e]);for(e=0;e<this.spriteMem.length;e++)this.spriteRamWriteUpdate(e,this.spriteMem[e])}};var o=function(t,e,i){this.width=t,this.height=e,this.name=i,this.tile=new Array(t*e),this.attrib=new Array(t*e);for(var s=0;s<t*e;s++)this.tile[s]=0,this.attrib[s]=0};o.prototype={getTileIndex:function(t,e){return this.tile[e*this.width+t]},getAttrib:function(t,e){return this.attrib[e*this.width+t]},writeAttrib:function(t,e){for(var i,s,n,r=t%8*4,o=4*Math.floor(t/8),h=0;h<2;h++)for(var a=0;a<2;a++){i=e>>2*(2*h+a)&3;for(var u=0;u<2;u++)for(var l=0;l<2;l++)s=r+2*a+l,(n=o+2*h+u)*this.width+s,this.attrib[n*this.width+s]=i<<2&12}},toJSON:function(){return{tile:this.tile,attrib:this.attrib}},fromJSON:function(t){this.tile=t.tile,this.attrib=t.attrib}};var h=function(){this.curTable=new Array(64),this.emphTable=new Array(8),this.currentEmph=-1};h.prototype={reset:function(){this.setEmphasis(0)},loadNTSCPalette:function(){this.curTable=[5395026,11796480,10485760,11599933,7602281,91,95,6208,12048,543240,26368,1196544,7153664,0,0,0,12899815,16728064,14421538,16729963,14090399,6818519,6588,21681,27227,35843,43776,2918400,10777088,0,0,0,16316664,16755516,16742785,16735173,16730354,14633471,4681215,46327,57599,58229,259115,7911470,15065624,7895160,0,0,16777215,16773822,16300216,16300248,16758527,16761855,13095423,10148607,8973816,8650717,12122296,16119980,16777136,16308472,0,0],this.makeTables(),this.setEmphasis(0)},loadPALPalette:function(){this.curTable=[5395026,11796480,10485760,11599933,7602281,91,95,6208,12048,543240,26368,1196544,7153664,0,0,0,12899815,16728064,14421538,16729963,14090399,6818519,6588,21681,27227,35843,43776,2918400,10777088,0,0,0,16316664,16755516,16742785,16735173,16730354,14633471,4681215,46327,57599,58229,259115,7911470,15065624,7895160,0,0,16777215,16773822,16300216,16300248,16758527,16761855,13095423,10148607,8973816,8650717,12122296,16119980,16777136,16308472,0,0],this.makeTables(),this.setEmphasis(0)},makeTables:function(){for(var t,e,i,s,n,r,o,h,a=0;a<8;a++)for(r=1,o=1,h=1,0!=(1&a)&&(r=.75,h=.75),0!=(2&a)&&(r=.75,o=.75),0!=(4&a)&&(o=.75,h=.75),this.emphTable[a]=new Array(64),n=0;n<64;n++)s=this.curTable[n],t=Math.floor(this.getRed(s)*r),e=Math.floor(this.getGreen(s)*o),i=Math.floor(this.getBlue(s)*h),this.emphTable[a][n]=this.getRgb(t,e,i)},setEmphasis:function(t){if(t!==this.currentEmph){this.currentEmph=t;for(var e=0;e<64;e++)this.curTable[e]=this.emphTable[t][e]}},getEntry:function(t){return this.curTable[t]},getRed:function(t){return t>>16&255},getGreen:function(t){return t>>8&255},getBlue:function(t){return 255&t},getRgb:function(t,e,i){return t<<16|e<<8|i},loadDefaultPalette:function(){this.curTable[0]=this.getRgb(117,117,117),this.curTable[1]=this.getRgb(39,27,143),this.curTable[2]=this.getRgb(0,0,171),this.curTable[3]=this.getRgb(71,0,159),this.curTable[4]=this.getRgb(143,0,119),this.curTable[5]=this.getRgb(171,0,19),this.curTable[6]=this.getRgb(167,0,0),this.curTable[7]=this.getRgb(127,11,0),this.curTable[8]=this.getRgb(67,47,0),this.curTable[9]=this.getRgb(0,71,0),this.curTable[10]=this.getRgb(0,81,0),this.curTable[11]=this.getRgb(0,63,23),this.curTable[12]=this.getRgb(27,63,95),this.curTable[13]=this.getRgb(0,0,0),this.curTable[14]=this.getRgb(0,0,0),this.curTable[15]=this.getRgb(0,0,0),this.curTable[16]=this.getRgb(188,188,188),this.curTable[17]=this.getRgb(0,115,239),this.curTable[18]=this.getRgb(35,59,239),this.curTable[19]=this.getRgb(131,0,243),this.curTable[20]=this.getRgb(191,0,191),this.curTable[21]=this.getRgb(231,0,91),this.curTable[22]=this.getRgb(219,43,0),this.curTable[23]=this.getRgb(203,79,15),this.curTable[24]=this.getRgb(139,115,0),this.curTable[25]=this.getRgb(0,151,0),this.curTable[26]=this.getRgb(0,171,0),this.curTable[27]=this.getRgb(0,147,59),this.curTable[28]=this.getRgb(0,131,139),this.curTable[29]=this.getRgb(0,0,0),this.curTable[30]=this.getRgb(0,0,0),this.curTable[31]=this.getRgb(0,0,0),this.curTable[32]=this.getRgb(255,255,255),this.curTable[33]=this.getRgb(63,191,255),this.curTable[34]=this.getRgb(95,151,255),this.curTable[35]=this.getRgb(167,139,253),this.curTable[36]=this.getRgb(247,123,255),this.curTable[37]=this.getRgb(255,119,183),this.curTable[38]=this.getRgb(255,119,99),this.curTable[39]=this.getRgb(255,155,59),this.curTable[40]=this.getRgb(243,191,63),this.curTable[41]=this.getRgb(131,211,19),this.curTable[42]=this.getRgb(79,223,75),this.curTable[43]=this.getRgb(88,248,152),this.curTable[44]=this.getRgb(0,235,219),this.curTable[45]=this.getRgb(0,0,0),this.curTable[46]=this.getRgb(0,0,0),this.curTable[47]=this.getRgb(0,0,0),this.curTable[48]=this.getRgb(255,255,255),this.curTable[49]=this.getRgb(171,231,255),this.curTable[50]=this.getRgb(199,215,255),this.curTable[51]=this.getRgb(215,203,255),this.curTable[52]=this.getRgb(255,199,255),this.curTable[53]=this.getRgb(255,199,219),this.curTable[54]=this.getRgb(255,191,179),this.curTable[55]=this.getRgb(255,219,171),this.curTable[56]=this.getRgb(255,231,163),this.curTable[57]=this.getRgb(227,255,163),this.curTable[58]=this.getRgb(171,243,191),this.curTable[59]=this.getRgb(179,255,207),this.curTable[60]=this.getRgb(159,255,243),this.curTable[61]=this.getRgb(0,0,0),this.curTable[62]=this.getRgb(0,0,0),this.curTable[63]=this.getRgb(0,0,0),this.makeTables(),this.setEmphasis(0)}},t.exports=r},function(t,e,i){var s=i(14),n=function(t){this.nes=t,this.mem=null,this.REG_ACC=null,this.REG_X=null,this.REG_Y=null,this.REG_SP=null,this.REG_PC=null,this.REG_PC_NEW=null,this.REG_STATUS=null,this.F_CARRY=null,this.F_DECIMAL=null,this.F_INTERRUPT=null,this.F_INTERRUPT_NEW=null,this.F_OVERFLOW=null,this.F_SIGN=null,this.F_ZERO=null,this.F_NOTUSED=null,this.F_NOTUSED_NEW=null,this.F_BRK=null,this.F_BRK_NEW=null,this.opdata=null,this.cyclesToHalt=null,this.crash=null,this.irqRequested=null,this.irqType=null,this.reset()};n.prototype={IRQ_NORMAL:0,IRQ_NMI:1,IRQ_RESET:2,reset:function(){this.mem=new Array(65536);for(var t=0;t<8192;t++)this.mem[t]=255;for(var e=0;e<4;e++){var i=2048*e;this.mem[i+8]=247,this.mem[i+9]=239,this.mem[i+10]=223,this.mem[i+15]=191}for(var s=8193;s<this.mem.length;s++)this.mem[s]=0;this.REG_ACC=0,this.REG_X=0,this.REG_Y=0,this.REG_SP=511,this.REG_PC=32767,this.REG_PC_NEW=32767,this.REG_STATUS=40,this.setStatus(40),this.F_CARRY=0,this.F_DECIMAL=0,this.F_INTERRUPT=1,this.F_INTERRUPT_NEW=1,this.F_OVERFLOW=0,this.F_SIGN=0,this.F_ZERO=1,this.F_NOTUSED=1,this.F_NOTUSED_NEW=1,this.F_BRK=1,this.F_BRK_NEW=1,this.opdata=(new r).opdata,this.cyclesToHalt=0,this.crash=!1,this.irqRequested=!1,this.irqType=null},emulate:function(){var t,e;if(this.irqRequested){switch(t=this.F_CARRY|(0===this.F_ZERO?1:0)<<1|this.F_INTERRUPT<<2|this.F_DECIMAL<<3|this.F_BRK<<4|this.F_NOTUSED<<5|this.F_OVERFLOW<<6|this.F_SIGN<<7,this.REG_PC_NEW=this.REG_PC,this.F_INTERRUPT_NEW=this.F_INTERRUPT,this.irqType){case 0:if(0!==this.F_INTERRUPT)break;this.doIrq(t);break;case 1:this.doNonMaskableInterrupt(t);break;case 2:this.doResetInterrupt()}this.REG_PC=this.REG_PC_NEW,this.F_INTERRUPT=this.F_INTERRUPT_NEW,this.F_BRK=this.F_BRK_NEW,this.irqRequested=!1}var i=this.opdata[this.nes.mmap.load(this.REG_PC+1)],s=i>>24,n=0,r=i>>8&255,o=this.REG_PC;this.REG_PC+=i>>16&255;var h=0;switch(r){case 0:h=this.load(o+2);break;case 1:h=this.load(o+2),h+=h<128?this.REG_PC:this.REG_PC-256;break;case 2:break;case 3:h=this.load16bit(o+2);break;case 4:h=this.REG_ACC;break;case 5:h=this.REG_PC;break;case 6:h=this.load(o+2)+this.REG_X&255;break;case 7:h=this.load(o+2)+this.REG_Y&255;break;case 8:(65280&(h=this.load16bit(o+2)))!=(h+this.REG_X&65280)&&(n=1),h+=this.REG_X;break;case 9:(65280&(h=this.load16bit(o+2)))!=(h+this.REG_Y&65280)&&(n=1),h+=this.REG_Y;break;case 10:(65280&(h=this.load(o+2)))!=(h+this.REG_X&65280)&&(n=1),h+=this.REG_X,h&=255,h=this.load16bit(h);break;case 11:(65280&(h=this.load16bit(this.load(o+2))))!=(h+this.REG_Y&65280)&&(n=1),h+=this.REG_Y;break;case 12:h=(h=this.load16bit(o+2))<8191?this.mem[h]+(this.mem[65280&h|1+(255&h)&255]<<8):this.nes.mmap.load(h)+(this.nes.mmap.load(65280&h|1+(255&h)&255)<<8)}switch(h&=65535,255&i){case 0:t=this.REG_ACC+this.load(h)+this.F_CARRY,0==(128&(this.REG_ACC^this.load(h)))&&0!=(128&(this.REG_ACC^t))?this.F_OVERFLOW=1:this.F_OVERFLOW=0,this.F_CARRY=t>255?1:0,this.F_SIGN=t>>7&1,this.F_ZERO=255&t,this.REG_ACC=255&t,s+=n;break;case 1:this.REG_ACC=this.REG_ACC&this.load(h),this.F_SIGN=this.REG_ACC>>7&1,this.F_ZERO=this.REG_ACC,11!==r&&(s+=n);break;case 2:4===r?(this.F_CARRY=this.REG_ACC>>7&1,this.REG_ACC=this.REG_ACC<<1&255,this.F_SIGN=this.REG_ACC>>7&1,this.F_ZERO=this.REG_ACC):(t=this.load(h),this.F_CARRY=t>>7&1,t=t<<1&255,this.F_SIGN=t>>7&1,this.F_ZERO=t,this.write(h,t));break;case 3:0===this.F_CARRY&&(s+=(65280&o)!=(65280&h)?2:1,this.REG_PC=h);break;case 4:1===this.F_CARRY&&(s+=(65280&o)!=(65280&h)?2:1,this.REG_PC=h);break;case 5:0===this.F_ZERO&&(s+=(65280&o)!=(65280&h)?2:1,this.REG_PC=h);break;case 6:t=this.load(h),this.F_SIGN=t>>7&1,this.F_OVERFLOW=t>>6&1,t&=this.REG_ACC,this.F_ZERO=t;break;case 7:1===this.F_SIGN&&(s++,this.REG_PC=h);break;case 8:0!==this.F_ZERO&&(s+=(65280&o)!=(65280&h)?2:1,this.REG_PC=h);break;case 9:0===this.F_SIGN&&(s+=(65280&o)!=(65280&h)?2:1,this.REG_PC=h);break;case 10:this.REG_PC+=2,this.push(this.REG_PC>>8&255),this.push(255&this.REG_PC),this.F_BRK=1,this.push(this.F_CARRY|(0===this.F_ZERO?1:0)<<1|this.F_INTERRUPT<<2|this.F_DECIMAL<<3|this.F_BRK<<4|this.F_NOTUSED<<5|this.F_OVERFLOW<<6|this.F_SIGN<<7),this.F_INTERRUPT=1,this.REG_PC=this.load16bit(65534),this.REG_PC--;break;case 11:0===this.F_OVERFLOW&&(s+=(65280&o)!=(65280&h)?2:1,this.REG_PC=h);break;case 12:1===this.F_OVERFLOW&&(s+=(65280&o)!=(65280&h)?2:1,this.REG_PC=h);break;case 13:this.F_CARRY=0;break;case 14:this.F_DECIMAL=0;break;case 15:this.F_INTERRUPT=0;break;case 16:this.F_OVERFLOW=0;break;case 17:t=this.REG_ACC-this.load(h),this.F_CARRY=t>=0?1:0,this.F_SIGN=t>>7&1,this.F_ZERO=255&t,s+=n;break;case 18:t=this.REG_X-this.load(h),this.F_CARRY=t>=0?1:0,this.F_SIGN=t>>7&1,this.F_ZERO=255&t;break;case 19:t=this.REG_Y-this.load(h),this.F_CARRY=t>=0?1:0,this.F_SIGN=t>>7&1,this.F_ZERO=255&t;break;case 20:t=this.load(h)-1&255,this.F_SIGN=t>>7&1,this.F_ZERO=t,this.write(h,t);break;case 21:this.REG_X=this.REG_X-1&255,this.F_SIGN=this.REG_X>>7&1,this.F_ZERO=this.REG_X;break;case 22:this.REG_Y=this.REG_Y-1&255,this.F_SIGN=this.REG_Y>>7&1,this.F_ZERO=this.REG_Y;break;case 23:this.REG_ACC=255&(this.load(h)^this.REG_ACC),this.F_SIGN=this.REG_ACC>>7&1,this.F_ZERO=this.REG_ACC,s+=n;break;case 24:t=this.load(h)+1&255,this.F_SIGN=t>>7&1,this.F_ZERO=t,this.write(h,255&t);break;case 25:this.REG_X=this.REG_X+1&255,this.F_SIGN=this.REG_X>>7&1,this.F_ZERO=this.REG_X;break;case 26:this.REG_Y++,this.REG_Y&=255,this.F_SIGN=this.REG_Y>>7&1,this.F_ZERO=this.REG_Y;break;case 27:this.REG_PC=h-1;break;case 28:this.push(this.REG_PC>>8&255),this.push(255&this.REG_PC),this.REG_PC=h-1;break;case 29:this.REG_ACC=this.load(h),this.F_SIGN=this.REG_ACC>>7&1,this.F_ZERO=this.REG_ACC,s+=n;break;case 30:this.REG_X=this.load(h),this.F_SIGN=this.REG_X>>7&1,this.F_ZERO=this.REG_X,s+=n;break;case 31:this.REG_Y=this.load(h),this.F_SIGN=this.REG_Y>>7&1,this.F_ZERO=this.REG_Y,s+=n;break;case 32:4===r?(t=255&this.REG_ACC,this.F_CARRY=1&t,t>>=1,this.REG_ACC=t):(t=255&this.load(h),this.F_CARRY=1&t,t>>=1,this.write(h,t)),this.F_SIGN=0,this.F_ZERO=t;break;case 33:break;case 34:t=255&(this.load(h)|this.REG_ACC),this.F_SIGN=t>>7&1,this.F_ZERO=t,this.REG_ACC=t,11!==r&&(s+=n);break;case 35:this.push(this.REG_ACC);break;case 36:this.F_BRK=1,this.push(this.F_CARRY|(0===this.F_ZERO?1:0)<<1|this.F_INTERRUPT<<2|this.F_DECIMAL<<3|this.F_BRK<<4|this.F_NOTUSED<<5|this.F_OVERFLOW<<6|this.F_SIGN<<7);break;case 37:this.REG_ACC=this.pull(),this.F_SIGN=this.REG_ACC>>7&1,this.F_ZERO=this.REG_ACC;break;case 38:t=this.pull(),this.F_CARRY=1&t,this.F_ZERO=1==(t>>1&1)?0:1,this.F_INTERRUPT=t>>2&1,this.F_DECIMAL=t>>3&1,this.F_BRK=t>>4&1,this.F_NOTUSED=t>>5&1,this.F_OVERFLOW=t>>6&1,this.F_SIGN=t>>7&1,this.F_NOTUSED=1;break;case 39:4===r?(t=this.REG_ACC,e=this.F_CARRY,this.F_CARRY=t>>7&1,t=(t<<1&255)+e,this.REG_ACC=t):(t=this.load(h),e=this.F_CARRY,this.F_CARRY=t>>7&1,t=(t<<1&255)+e,this.write(h,t)),this.F_SIGN=t>>7&1,this.F_ZERO=t;break;case 40:4===r?(e=this.F_CARRY<<7,this.F_CARRY=1&this.REG_ACC,t=(this.REG_ACC>>1)+e,this.REG_ACC=t):(t=this.load(h),e=this.F_CARRY<<7,this.F_CARRY=1&t,t=(t>>1)+e,this.write(h,t)),this.F_SIGN=t>>7&1,this.F_ZERO=t;break;case 41:if(t=this.pull(),this.F_CARRY=1&t,this.F_ZERO=0==(t>>1&1)?1:0,this.F_INTERRUPT=t>>2&1,this.F_DECIMAL=t>>3&1,this.F_BRK=t>>4&1,this.F_NOTUSED=t>>5&1,this.F_OVERFLOW=t>>6&1,this.F_SIGN=t>>7&1,this.REG_PC=this.pull(),this.REG_PC+=this.pull()<<8,65535===this.REG_PC)return;this.REG_PC--,this.F_NOTUSED=1;break;case 42:if(this.REG_PC=this.pull(),this.REG_PC+=this.pull()<<8,65535===this.REG_PC)return;break;case 43:t=this.REG_ACC-this.load(h)-(1-this.F_CARRY),this.F_SIGN=t>>7&1,this.F_ZERO=255&t,0!=(128&(this.REG_ACC^t))&&0!=(128&(this.REG_ACC^this.load(h)))?this.F_OVERFLOW=1:this.F_OVERFLOW=0,this.F_CARRY=t<0?0:1,this.REG_ACC=255&t,11!==r&&(s+=n);break;case 44:this.F_CARRY=1;break;case 45:this.F_DECIMAL=1;break;case 46:this.F_INTERRUPT=1;break;case 47:this.write(h,this.REG_ACC);break;case 48:this.write(h,this.REG_X);break;case 49:this.write(h,this.REG_Y);break;case 50:this.REG_X=this.REG_ACC,this.F_SIGN=this.REG_ACC>>7&1,this.F_ZERO=this.REG_ACC;break;case 51:this.REG_Y=this.REG_ACC,this.F_SIGN=this.REG_ACC>>7&1,this.F_ZERO=this.REG_ACC;break;case 52:this.REG_X=this.REG_SP-256,this.F_SIGN=this.REG_SP>>7&1,this.F_ZERO=this.REG_X;break;case 53:this.REG_ACC=this.REG_X,this.F_SIGN=this.REG_X>>7&1,this.F_ZERO=this.REG_X;break;case 54:this.REG_SP=this.REG_X+256,this.stackWrap();break;case 55:this.REG_ACC=this.REG_Y,this.F_SIGN=this.REG_Y>>7&1,this.F_ZERO=this.REG_Y;break;default:this.nes.stop(),this.nes.crashMessage="Game crashed, invalid opcode at address $"+o.toString(16)}return s},load:function(t){return t<8192?this.mem[2047&t]:this.nes.mmap.load(t)},load16bit:function(t){return t<8191?this.mem[2047&t]|this.mem[t+1&2047]<<8:this.nes.mmap.load(t)|this.nes.mmap.load(t+1)<<8},write:function(t,e){t<8192?this.mem[2047&t]=e:this.nes.mmap.write(t,e)},requestIrq:function(t){this.irqRequested&&t===this.IRQ_NORMAL||(this.irqRequested=!0,this.irqType=t)},push:function(t){this.nes.mmap.write(this.REG_SP,t),this.REG_SP--,this.REG_SP=256|255&this.REG_SP},stackWrap:function(){this.REG_SP=256|255&this.REG_SP},pull:function(){return this.REG_SP++,this.REG_SP=256|255&this.REG_SP,this.nes.mmap.load(this.REG_SP)},pageCrossed:function(t,e){return(65280&t)!=(65280&e)},haltCycles:function(t){this.cyclesToHalt+=t},doNonMaskableInterrupt:function(t){0!=(128&this.nes.mmap.load(8192))&&(this.REG_PC_NEW++,this.push(this.REG_PC_NEW>>8&255),this.push(255&this.REG_PC_NEW),this.push(t),this.REG_PC_NEW=this.nes.mmap.load(65530)|this.nes.mmap.load(65531)<<8,this.REG_PC_NEW--)},doResetInterrupt:function(){this.REG_PC_NEW=this.nes.mmap.load(65532)|this.nes.mmap.load(65533)<<8,this.REG_PC_NEW--},doIrq:function(t){this.REG_PC_NEW++,this.push(this.REG_PC_NEW>>8&255),this.push(255&this.REG_PC_NEW),this.push(t),this.F_INTERRUPT_NEW=1,this.F_BRK_NEW=0,this.REG_PC_NEW=this.nes.mmap.load(65534)|this.nes.mmap.load(65535)<<8,this.REG_PC_NEW--},getStatus:function(){return this.F_CARRY|this.F_ZERO<<1|this.F_INTERRUPT<<2|this.F_DECIMAL<<3|this.F_BRK<<4|this.F_NOTUSED<<5|this.F_OVERFLOW<<6|this.F_SIGN<<7},setStatus:function(t){this.F_CARRY=1&t,this.F_ZERO=t>>1&1,this.F_INTERRUPT=t>>2&1,this.F_DECIMAL=t>>3&1,this.F_BRK=t>>4&1,this.F_NOTUSED=t>>5&1,this.F_OVERFLOW=t>>6&1,this.F_SIGN=t>>7&1},JSON_PROPERTIES:["mem","cyclesToHalt","irqRequested","irqType","REG_ACC","REG_X","REG_Y","REG_SP","REG_PC","REG_PC_NEW","REG_STATUS","F_CARRY","F_DECIMAL","F_INTERRUPT","F_INTERRUPT_NEW","F_OVERFLOW","F_SIGN","F_ZERO","F_NOTUSED","F_NOTUSED_NEW","F_BRK","F_BRK_NEW"],toJSON:function(){return s.toJSON(this)},fromJSON:function(t){s.fromJSON(this,t)}};var r=function(){this.opdata=new Array(256);for(var t=0;t<256;t++)this.opdata[t]=255;this.setOp(this.INS_ADC,105,this.ADDR_IMM,2,2),this.setOp(this.INS_ADC,101,this.ADDR_ZP,2,3),this.setOp(this.INS_ADC,117,this.ADDR_ZPX,2,4),this.setOp(this.INS_ADC,109,this.ADDR_ABS,3,4),this.setOp(this.INS_ADC,125,this.ADDR_ABSX,3,4),this.setOp(this.INS_ADC,121,this.ADDR_ABSY,3,4),this.setOp(this.INS_ADC,97,this.ADDR_PREIDXIND,2,6),this.setOp(this.INS_ADC,113,this.ADDR_POSTIDXIND,2,5),this.setOp(this.INS_AND,41,this.ADDR_IMM,2,2),this.setOp(this.INS_AND,37,this.ADDR_ZP,2,3),this.setOp(this.INS_AND,53,this.ADDR_ZPX,2,4),this.setOp(this.INS_AND,45,this.ADDR_ABS,3,4),this.setOp(this.INS_AND,61,this.ADDR_ABSX,3,4),this.setOp(this.INS_AND,57,this.ADDR_ABSY,3,4),this.setOp(this.INS_AND,33,this.ADDR_PREIDXIND,2,6),this.setOp(this.INS_AND,49,this.ADDR_POSTIDXIND,2,5),this.setOp(this.INS_ASL,10,this.ADDR_ACC,1,2),this.setOp(this.INS_ASL,6,this.ADDR_ZP,2,5),this.setOp(this.INS_ASL,22,this.ADDR_ZPX,2,6),this.setOp(this.INS_ASL,14,this.ADDR_ABS,3,6),this.setOp(this.INS_ASL,30,this.ADDR_ABSX,3,7),this.setOp(this.INS_BCC,144,this.ADDR_REL,2,2),this.setOp(this.INS_BCS,176,this.ADDR_REL,2,2),this.setOp(this.INS_BEQ,240,this.ADDR_REL,2,2),this.setOp(this.INS_BIT,36,this.ADDR_ZP,2,3),this.setOp(this.INS_BIT,44,this.ADDR_ABS,3,4),this.setOp(this.INS_BMI,48,this.ADDR_REL,2,2),this.setOp(this.INS_BNE,208,this.ADDR_REL,2,2),this.setOp(this.INS_BPL,16,this.ADDR_REL,2,2),this.setOp(this.INS_BRK,0,this.ADDR_IMP,1,7),this.setOp(this.INS_BVC,80,this.ADDR_REL,2,2),this.setOp(this.INS_BVS,112,this.ADDR_REL,2,2),this.setOp(this.INS_CLC,24,this.ADDR_IMP,1,2),this.setOp(this.INS_CLD,216,this.ADDR_IMP,1,2),this.setOp(this.INS_CLI,88,this.ADDR_IMP,1,2),this.setOp(this.INS_CLV,184,this.ADDR_IMP,1,2),this.setOp(this.INS_CMP,201,this.ADDR_IMM,2,2),this.setOp(this.INS_CMP,197,this.ADDR_ZP,2,3),this.setOp(this.INS_CMP,213,this.ADDR_ZPX,2,4),this.setOp(this.INS_CMP,205,this.ADDR_ABS,3,4),this.setOp(this.INS_CMP,221,this.ADDR_ABSX,3,4),this.setOp(this.INS_CMP,217,this.ADDR_ABSY,3,4),this.setOp(this.INS_CMP,193,this.ADDR_PREIDXIND,2,6),this.setOp(this.INS_CMP,209,this.ADDR_POSTIDXIND,2,5),this.setOp(this.INS_CPX,224,this.ADDR_IMM,2,2),this.setOp(this.INS_CPX,228,this.ADDR_ZP,2,3),this.setOp(this.INS_CPX,236,this.ADDR_ABS,3,4),this.setOp(this.INS_CPY,192,this.ADDR_IMM,2,2),this.setOp(this.INS_CPY,196,this.ADDR_ZP,2,3),this.setOp(this.INS_CPY,204,this.ADDR_ABS,3,4),this.setOp(this.INS_DEC,198,this.ADDR_ZP,2,5),this.setOp(this.INS_DEC,214,this.ADDR_ZPX,2,6),this.setOp(this.INS_DEC,206,this.ADDR_ABS,3,6),this.setOp(this.INS_DEC,222,this.ADDR_ABSX,3,7),this.setOp(this.INS_DEX,202,this.ADDR_IMP,1,2),this.setOp(this.INS_DEY,136,this.ADDR_IMP,1,2),this.setOp(this.INS_EOR,73,this.ADDR_IMM,2,2),this.setOp(this.INS_EOR,69,this.ADDR_ZP,2,3),this.setOp(this.INS_EOR,85,this.ADDR_ZPX,2,4),this.setOp(this.INS_EOR,77,this.ADDR_ABS,3,4),this.setOp(this.INS_EOR,93,this.ADDR_ABSX,3,4),this.setOp(this.INS_EOR,89,this.ADDR_ABSY,3,4),this.setOp(this.INS_EOR,65,this.ADDR_PREIDXIND,2,6),this.setOp(this.INS_EOR,81,this.ADDR_POSTIDXIND,2,5),this.setOp(this.INS_INC,230,this.ADDR_ZP,2,5),this.setOp(this.INS_INC,246,this.ADDR_ZPX,2,6),this.setOp(this.INS_INC,238,this.ADDR_ABS,3,6),this.setOp(this.INS_INC,254,this.ADDR_ABSX,3,7),this.setOp(this.INS_INX,232,this.ADDR_IMP,1,2),this.setOp(this.INS_INY,200,this.ADDR_IMP,1,2),this.setOp(this.INS_JMP,76,this.ADDR_ABS,3,3),this.setOp(this.INS_JMP,108,this.ADDR_INDABS,3,5),this.setOp(this.INS_JSR,32,this.ADDR_ABS,3,6),this.setOp(this.INS_LDA,169,this.ADDR_IMM,2,2),this.setOp(this.INS_LDA,165,this.ADDR_ZP,2,3),this.setOp(this.INS_LDA,181,this.ADDR_ZPX,2,4),this.setOp(this.INS_LDA,173,this.ADDR_ABS,3,4),this.setOp(this.INS_LDA,189,this.ADDR_ABSX,3,4),this.setOp(this.INS_LDA,185,this.ADDR_ABSY,3,4),this.setOp(this.INS_LDA,161,this.ADDR_PREIDXIND,2,6),this.setOp(this.INS_LDA,177,this.ADDR_POSTIDXIND,2,5),this.setOp(this.INS_LDX,162,this.ADDR_IMM,2,2),this.setOp(this.INS_LDX,166,this.ADDR_ZP,2,3),this.setOp(this.INS_LDX,182,this.ADDR_ZPY,2,4),this.setOp(this.INS_LDX,174,this.ADDR_ABS,3,4),this.setOp(this.INS_LDX,190,this.ADDR_ABSY,3,4),this.setOp(this.INS_LDY,160,this.ADDR_IMM,2,2),this.setOp(this.INS_LDY,164,this.ADDR_ZP,2,3),this.setOp(this.INS_LDY,180,this.ADDR_ZPX,2,4),this.setOp(this.INS_LDY,172,this.ADDR_ABS,3,4),this.setOp(this.INS_LDY,188,this.ADDR_ABSX,3,4),this.setOp(this.INS_LSR,74,this.ADDR_ACC,1,2),this.setOp(this.INS_LSR,70,this.ADDR_ZP,2,5),this.setOp(this.INS_LSR,86,this.ADDR_ZPX,2,6),this.setOp(this.INS_LSR,78,this.ADDR_ABS,3,6),this.setOp(this.INS_LSR,94,this.ADDR_ABSX,3,7),this.setOp(this.INS_NOP,234,this.ADDR_IMP,1,2),this.setOp(this.INS_ORA,9,this.ADDR_IMM,2,2),this.setOp(this.INS_ORA,5,this.ADDR_ZP,2,3),this.setOp(this.INS_ORA,21,this.ADDR_ZPX,2,4),this.setOp(this.INS_ORA,13,this.ADDR_ABS,3,4),this.setOp(this.INS_ORA,29,this.ADDR_ABSX,3,4),this.setOp(this.INS_ORA,25,this.ADDR_ABSY,3,4),this.setOp(this.INS_ORA,1,this.ADDR_PREIDXIND,2,6),this.setOp(this.INS_ORA,17,this.ADDR_POSTIDXIND,2,5),this.setOp(this.INS_PHA,72,this.ADDR_IMP,1,3),this.setOp(this.INS_PHP,8,this.ADDR_IMP,1,3),this.setOp(this.INS_PLA,104,this.ADDR_IMP,1,4),this.setOp(this.INS_PLP,40,this.ADDR_IMP,1,4),this.setOp(this.INS_ROL,42,this.ADDR_ACC,1,2),this.setOp(this.INS_ROL,38,this.ADDR_ZP,2,5),this.setOp(this.INS_ROL,54,this.ADDR_ZPX,2,6),this.setOp(this.INS_ROL,46,this.ADDR_ABS,3,6),this.setOp(this.INS_ROL,62,this.ADDR_ABSX,3,7),this.setOp(this.INS_ROR,106,this.ADDR_ACC,1,2),this.setOp(this.INS_ROR,102,this.ADDR_ZP,2,5),this.setOp(this.INS_ROR,118,this.ADDR_ZPX,2,6),this.setOp(this.INS_ROR,110,this.ADDR_ABS,3,6),this.setOp(this.INS_ROR,126,this.ADDR_ABSX,3,7),this.setOp(this.INS_RTI,64,this.ADDR_IMP,1,6),this.setOp(this.INS_RTS,96,this.ADDR_IMP,1,6),this.setOp(this.INS_SBC,233,this.ADDR_IMM,2,2),this.setOp(this.INS_SBC,229,this.ADDR_ZP,2,3),this.setOp(this.INS_SBC,245,this.ADDR_ZPX,2,4),this.setOp(this.INS_SBC,237,this.ADDR_ABS,3,4),this.setOp(this.INS_SBC,253,this.ADDR_ABSX,3,4),this.setOp(this.INS_SBC,249,this.ADDR_ABSY,3,4),this.setOp(this.INS_SBC,225,this.ADDR_PREIDXIND,2,6),this.setOp(this.INS_SBC,241,this.ADDR_POSTIDXIND,2,5),this.setOp(this.INS_SEC,56,this.ADDR_IMP,1,2),this.setOp(this.INS_SED,248,this.ADDR_IMP,1,2),this.setOp(this.INS_SEI,120,this.ADDR_IMP,1,2),this.setOp(this.INS_STA,133,this.ADDR_ZP,2,3),this.setOp(this.INS_STA,149,this.ADDR_ZPX,2,4),this.setOp(this.INS_STA,141,this.ADDR_ABS,3,4),this.setOp(this.INS_STA,157,this.ADDR_ABSX,3,5),this.setOp(this.INS_STA,153,this.ADDR_ABSY,3,5),this.setOp(this.INS_STA,129,this.ADDR_PREIDXIND,2,6),this.setOp(this.INS_STA,145,this.ADDR_POSTIDXIND,2,6),this.setOp(this.INS_STX,134,this.ADDR_ZP,2,3),this.setOp(this.INS_STX,150,this.ADDR_ZPY,2,4),this.setOp(this.INS_STX,142,this.ADDR_ABS,3,4),this.setOp(this.INS_STY,132,this.ADDR_ZP,2,3),this.setOp(this.INS_STY,148,this.ADDR_ZPX,2,4),this.setOp(this.INS_STY,140,this.ADDR_ABS,3,4),this.setOp(this.INS_TAX,170,this.ADDR_IMP,1,2),this.setOp(this.INS_TAY,168,this.ADDR_IMP,1,2),this.setOp(this.INS_TSX,186,this.ADDR_IMP,1,2),this.setOp(this.INS_TXA,138,this.ADDR_IMP,1,2),this.setOp(this.INS_TXS,154,this.ADDR_IMP,1,2),this.setOp(this.INS_TYA,152,this.ADDR_IMP,1,2),this.cycTable=new Array(7,6,2,8,3,3,5,5,3,2,2,2,4,4,6,6,2,5,2,8,4,4,6,6,2,4,2,7,4,4,7,7,6,6,2,8,3,3,5,5,4,2,2,2,4,4,6,6,2,5,2,8,4,4,6,6,2,4,2,7,4,4,7,7,6,6,2,8,3,3,5,5,3,2,2,2,3,4,6,6,2,5,2,8,4,4,6,6,2,4,2,7,4,4,7,7,6,6,2,8,3,3,5,5,4,2,2,2,5,4,6,6,2,5,2,8,4,4,6,6,2,4,2,7,4,4,7,7,2,6,2,6,3,3,3,3,2,2,2,2,4,4,4,4,2,6,2,6,4,4,4,4,2,5,2,5,5,5,5,5,2,6,2,6,3,3,3,3,2,2,2,2,4,4,4,4,2,5,2,5,4,4,4,4,2,4,2,4,4,4,4,4,2,6,2,8,3,3,5,5,2,2,2,2,4,4,6,6,2,5,2,8,4,4,6,6,2,4,2,7,4,4,7,7,2,6,3,8,3,3,5,5,2,2,2,2,4,4,6,6,2,5,2,8,4,4,6,6,2,4,2,7,4,4,7,7),this.instname=new Array(56),this.instname[0]="ADC",this.instname[1]="AND",this.instname[2]="ASL",this.instname[3]="BCC",this.instname[4]="BCS",this.instname[5]="BEQ",this.instname[6]="BIT",this.instname[7]="BMI",this.instname[8]="BNE",this.instname[9]="BPL",this.instname[10]="BRK",this.instname[11]="BVC",this.instname[12]="BVS",this.instname[13]="CLC",this.instname[14]="CLD",this.instname[15]="CLI",this.instname[16]="CLV",this.instname[17]="CMP",this.instname[18]="CPX",this.instname[19]="CPY",this.instname[20]="DEC",this.instname[21]="DEX",this.instname[22]="DEY",this.instname[23]="EOR",this.instname[24]="INC",this.instname[25]="INX",this.instname[26]="INY",this.instname[27]="JMP",this.instname[28]="JSR",this.instname[29]="LDA",this.instname[30]="LDX",this.instname[31]="LDY",this.instname[32]="LSR",this.instname[33]="NOP",this.instname[34]="ORA",this.instname[35]="PHA",this.instname[36]="PHP",this.instname[37]="PLA",this.instname[38]="PLP",this.instname[39]="ROL",this.instname[40]="ROR",this.instname[41]="RTI",this.instname[42]="RTS",this.instname[43]="SBC",this.instname[44]="SEC",this.instname[45]="SED",this.instname[46]="SEI",this.instname[47]="STA",this.instname[48]="STX",this.instname[49]="STY",this.instname[50]="TAX",this.instname[51]="TAY",this.instname[52]="TSX",this.instname[53]="TXA",this.instname[54]="TXS",this.instname[55]="TYA",this.addrDesc=new Array("Zero Page           ","Relative            ","Implied             ","Absolute            ","Accumulator         ","Immediate           ","Zero Page,X         ","Zero Page,Y         ","Absolute,X          ","Absolute,Y          ","Preindexed Indirect ","Postindexed Indirect","Indirect Absolute   ")};r.prototype={INS_ADC:0,INS_AND:1,INS_ASL:2,INS_BCC:3,INS_BCS:4,INS_BEQ:5,INS_BIT:6,INS_BMI:7,INS_BNE:8,INS_BPL:9,INS_BRK:10,INS_BVC:11,INS_BVS:12,INS_CLC:13,INS_CLD:14,INS_CLI:15,INS_CLV:16,INS_CMP:17,INS_CPX:18,INS_CPY:19,INS_DEC:20,INS_DEX:21,INS_DEY:22,INS_EOR:23,INS_INC:24,INS_INX:25,INS_INY:26,INS_JMP:27,INS_JSR:28,INS_LDA:29,INS_LDX:30,INS_LDY:31,INS_LSR:32,INS_NOP:33,INS_ORA:34,INS_PHA:35,INS_PHP:36,INS_PLA:37,INS_PLP:38,INS_ROL:39,INS_ROR:40,INS_RTI:41,INS_RTS:42,INS_SBC:43,INS_SEC:44,INS_SED:45,INS_SEI:46,INS_STA:47,INS_STX:48,INS_STY:49,INS_TAX:50,INS_TAY:51,INS_TSX:52,INS_TXA:53,INS_TXS:54,INS_TYA:55,INS_DUMMY:56,ADDR_ZP:0,ADDR_REL:1,ADDR_IMP:2,ADDR_ABS:3,ADDR_ACC:4,ADDR_IMM:5,ADDR_ZPX:6,ADDR_ZPY:7,ADDR_ABSX:8,ADDR_ABSY:9,ADDR_PREIDXIND:10,ADDR_POSTIDXIND:11,ADDR_INDABS:12,setOp:function(t,e,i,s,n){this.opdata[e]=255&t|(255&i)<<8|(255&s)<<16|(255&n)<<24}},t.exports=n},function(t,e,i){var s=i(60),n=i(25),r=i(59),o=i(58),h=i(57),a=function(t){var e;if(this.opts={onFrame:function(){},onAudioSample:null,onStatusUpdate:function(){},onBatteryRamWrite:function(){},preferredFrameRate:60,emulateSound:!0,sampleRate:44100},void 0!==t)for(e in this.opts)void 0!==t[e]&&(this.opts[e]=t[e]);this.frameTime=1e3/this.opts.preferredFrameRate,this.ui={writeFrame:this.opts.onFrame,updateStatus:this.opts.onStatusUpdate},this.cpu=new s(this),this.ppu=new r(this),this.papu=new o(this),this.mmap=null,this.controllers={1:new n,2:new n},this.ui.updateStatus("Ready to load a ROM."),this.frame=this.frame.bind(this),this.buttonDown=this.buttonDown.bind(this),this.buttonUp=this.buttonUp.bind(this),this.zapperMove=this.zapperMove.bind(this),this.zapperFireDown=this.zapperFireDown.bind(this),this.zapperFireUp=this.zapperFireUp.bind(this)};a.prototype={fpsFrameCount:0,romData:null,reset:function(){null!==this.mmap&&this.mmap.reset(),this.cpu.reset(),this.ppu.reset(),this.papu.reset(),this.lastFpsTime=null,this.fpsFrameCount=0},frame:function(){this.ppu.startFrame();var t=0,e=this.opts.emulateSound,i=this.cpu,s=this.ppu,n=this.papu;t:for(;;)for(0===i.cyclesToHalt?(t=i.emulate(),e&&n.clockFrameCounter(t),t*=3):i.cyclesToHalt>8?(t=24,e&&n.clockFrameCounter(8),i.cyclesToHalt-=8):(t=3*i.cyclesToHalt,e&&n.clockFrameCounter(i.cyclesToHalt),i.cyclesToHalt=0);t>0;t--){if(s.curX===s.spr0HitX&&1===s.f_spVisibility&&s.scanline-21===s.spr0HitY&&s.setStatusFlag(s.STATUS_SPRITE0HIT,!0),s.requestEndFrame&&(s.nmiCounter--,0===s.nmiCounter)){s.requestEndFrame=!1,s.startVBlank();break t}s.curX++,341===s.curX&&(s.curX=0,s.endScanline())}this.fpsFrameCount++},buttonDown:function(t,e){this.controllers[t].buttonDown(e)},buttonUp:function(t,e){this.controllers[t].buttonUp(e)},zapperMove:function(t,e){this.mmap&&(this.mmap.zapperX=t,this.mmap.zapperY=e)},zapperFireDown:function(){this.mmap&&(this.mmap.zapperFired=!0)},zapperFireUp:function(){this.mmap&&(this.mmap.zapperFired=!1)},getFPS:function(){var t=+new Date,e=null;return this.lastFpsTime&&(e=this.fpsFrameCount/((t-this.lastFpsTime)/1e3)),this.fpsFrameCount=0,this.lastFpsTime=t,e},reloadROM:function(){null!==this.romData&&this.loadROM(this.romData)},loadROM:function(t){this.rom=new h(this),this.rom.load(t),this.reset(),this.mmap=this.rom.createMapper(),this.mmap.loadROM(),this.ppu.setMirroring(this.rom.getMirroringType()),this.romData=t},setFramerate:function(t){this.opts.preferredFrameRate=t,this.frameTime=1e3/t,this.papu.setSampleRate(this.opts.sampleRate,!1)},toJSON:function(){return{romData:this.romData,cpu:this.cpu.toJSON(),mmap:this.mmap.toJSON(),ppu:this.ppu.toJSON()}},fromJSON:function(t){this.loadROM(t.romData),this.cpu.fromJSON(t.cpu),this.mmap.fromJSON(t.mmap),this.ppu.fromJSON(t.ppu)}},t.exports=a},function(t,e,i){var s=i(10),n=i(7),r=NaN,o=/^\s+|\s+$/g,h=/^[-+]0x[0-9a-f]+$/i,a=/^0b[01]+$/i,u=/^0o[0-7]+$/i,l=parseInt;t.exports=function(t){if("number"==typeof t)return t;if(n(t))return r;if(s(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=s(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=t.replace(o,"");var i=a.test(t);return i||u.test(t)?l(t.slice(2),i?2:8):h.test(t)?r:+t}},function(t,e,i){var s=i(62),n=1/0,r=1.7976931348623157e308;t.exports=function(t){return t?(t=s(t))===n||t===-n?(t<0?-1:1)*r:t==t?t:0:0===t?t:0}},function(t,e,i){var s=i(63);t.exports=function(t){var e=s(t),i=e%1;return e==e?i?e-i:e:0}},function(t,e){t.exports=function(t,e,i,s){for(var n=t.length,r=i+(s?1:-1);s?r--:++r<n;)if(e(t[r],r,t))return r;return-1}},function(t,e,i){var s=i(65),n=i(43),r=i(64),o=Math.max;t.exports=function(t,e,i){var h=null==t?0:t.length;if(!h)return-1;var a=null==i?0:r(i);return a<0&&(a=o(h+a,0)),s(t,n(e,3),a)}},function(t,e,i){var s=i(27);t.exports=function(t){return function(e){return s(e,t)}}},function(t,e){t.exports=function(t){return function(e){return null==e?void 0:e[t]}}},function(t,e,i){var s=i(68),n=i(67),r=i(16),o=i(6);t.exports=function(t){return r(t)?s(o(t)):n(t)}},function(t,e){t.exports=function(t){return t}},function(t,e,i){var s=i(26),n=i(35),r=i(1),o=i(32),h=i(17),a=i(6);t.exports=function(t,e,i){for(var u=-1,l=(e=s(e,t)).length,c=!1;++u<l;){var p=a(e[u]);if(!(c=null!=t&&i(t,p)))break;t=t[p]}return c||++u!=l?c:!!(l=null==t?0:t.length)&&h(l)&&o(p,l)&&(r(t)||n(t))}},function(t,e){t.exports=function(t,e){return null!=t&&e in Object(t)}},function(t,e,i){var s=i(72),n=i(71);t.exports=function(t,e){return null!=t&&n(t,e,s)}},function(t,e){t.exports=function(t,e){for(var i=-1,s=null==t?0:t.length,n=Array(s);++i<s;)n[i]=e(t[i],i,t);return n}},function(t,e,i){var s=i(11),n=i(74),r=i(1),o=i(7),h=1/0,a=s?s.prototype:void 0,u=a?a.toString:void 0;t.exports=function t(e){if("string"==typeof e)return e;if(r(e))return n(e,t)+"";if(o(e))return u?u.call(e):"";var i=e+"";return"0"==i&&1/e==-h?"-0":i}},function(t,e,i){var s=i(75);t.exports=function(t){return null==t?"":s(t)}},function(t,e,i){var s=i(19),n="Expected a function";function r(t,e){if("function"!=typeof t||null!=e&&"function"!=typeof e)throw new TypeError(n);var i=function(){var s=arguments,n=e?e.apply(this,s):s[0],r=i.cache;if(r.has(n))return r.get(n);var o=t.apply(this,s);return i.cache=r.set(n,o)||r,o};return i.cache=new(r.Cache||s),i}r.Cache=s,t.exports=r},function(t,e,i){var s=i(77),n=500;t.exports=function(t){var e=s(t,function(t){return i.size===n&&i.clear(),t}),i=e.cache;return e}},function(t,e,i){var s=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,n=/\\(\\)?/g,r=i(78)(function(t){var e=[];return 46===t.charCodeAt(0)&&e.push(""),t.replace(s,function(t,i,s,r){e.push(s?r.replace(n,"$1"):i||t)}),e});t.exports=r},function(t,e,i){var s=i(27);t.exports=function(t,e,i){var n=null==t?void 0:s(t,e);return void 0===n?i:n}},function(t,e,i){var s=i(37),n=i(80),r=i(73),o=i(16),h=i(29),a=i(28),u=i(6),l=1,c=2;t.exports=function(t,e){return o(t)&&h(e)?a(u(t),e):function(i){var o=n(i,t);return void 0===o&&o===e?r(i,t):s(e,o,l|c)}}},function(t,e,i){var s=i(29),n=i(18);t.exports=function(t){for(var e=n(t),i=e.length;i--;){var r=e[i],o=t[r];e[i]=[r,o,s(o)]}return e}},function(t,e,i){var s=i(3)(i(0),"WeakMap");t.exports=s},function(t,e,i){var s=i(3)(i(0),"Set");t.exports=s},function(t,e,i){var s=i(3)(i(0),"Promise");t.exports=s},function(t,e,i){var s=i(3)(i(0),"DataView");t.exports=s},function(t,e,i){var s=i(86),n=i(20),r=i(85),o=i(84),h=i(83),a=i(5),u=i(38),l=u(s),c=u(n),p=u(r),f=u(o),m=u(h),d=a;(s&&"[object DataView]"!=d(new s(new ArrayBuffer(1)))||n&&"[object Map]"!=d(new n)||r&&"[object Promise]"!=d(r.resolve())||o&&"[object Set]"!=d(new o)||h&&"[object WeakMap]"!=d(new h))&&(d=function(t){var e=a(t),i="[object Object]"==e?t.constructor:void 0,s=i?u(i):"";if(s)switch(s){case l:return"[object DataView]";case c:return"[object Map]";case p:return"[object Promise]";case f:return"[object Set]";case m:return"[object WeakMap]"}return e}),t.exports=d},function(t,e){t.exports=function(t,e){return function(i){return t(e(i))}}},function(t,e,i){var s=i(88)(Object.keys,Object);t.exports=s},function(t,e){var i=Object.prototype;t.exports=function(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||i)}},function(t,e,i){var s=i(90),n=i(89),r=Object.prototype.hasOwnProperty;t.exports=function(t){if(!s(t))return n(t);var e=[];for(var i in Object(t))r.call(t,i)&&"constructor"!=i&&e.push(i);return e}},function(t,e,i){(function(t){var s=i(39),n="object"==typeof e&&e&&!e.nodeType&&e,r=n&&"object"==typeof t&&t&&!t.nodeType&&t,o=r&&r.exports===n&&s.process,h=function(){try{var t=r&&r.require&&r.require("util").types;return t||o&&o.binding&&o.binding("util")}catch(t){}}();t.exports=h}).call(this,i(33)(t))},function(t,e){t.exports=function(t){return function(e){return t(e)}}},function(t,e,i){var s=i(5),n=i(17),r=i(4),o={};o["[object Float32Array]"]=o["[object Float64Array]"]=o["[object Int8Array]"]=o["[object Int16Array]"]=o["[object Int32Array]"]=o["[object Uint8Array]"]=o["[object Uint8ClampedArray]"]=o["[object Uint16Array]"]=o["[object Uint32Array]"]=!0,o["[object Arguments]"]=o["[object Array]"]=o["[object ArrayBuffer]"]=o["[object Boolean]"]=o["[object DataView]"]=o["[object Date]"]=o["[object Error]"]=o["[object Function]"]=o["[object Map]"]=o["[object Number]"]=o["[object Object]"]=o["[object RegExp]"]=o["[object Set]"]=o["[object String]"]=o["[object WeakMap]"]=!1,t.exports=function(t){return r(t)&&n(t.length)&&!!o[s(t)]}},function(t,e){t.exports=function(){return!1}},function(t,e,i){var s=i(5),n=i(4),r="[object Arguments]";t.exports=function(t){return n(t)&&s(t)==r}},function(t,e){t.exports=function(t,e){for(var i=-1,s=Array(t);++i<t;)s[i]=e(i);return s}},function(t,e,i){var s=i(97),n=i(35),r=i(1),o=i(34),h=i(32),a=i(31),u=Object.prototype.hasOwnProperty;t.exports=function(t,e){var i=r(t),l=!i&&n(t),c=!i&&!l&&o(t),p=!i&&!l&&!c&&a(t),f=i||l||c||p,m=f?s(t.length,String):[],d=m.length;for(var _ in t)!e&&!u.call(t,_)||f&&("length"==_||c&&("offset"==_||"parent"==_)||p&&("buffer"==_||"byteLength"==_||"byteOffset"==_)||h(_,d))||m.push(_);return m}},function(t,e){t.exports=function(){return[]}},function(t,e){t.exports=function(t,e){for(var i=-1,s=null==t?0:t.length,n=0,r=[];++i<s;){var o=t[i];e(o,i,t)&&(r[n++]=o)}return r}},function(t,e,i){var s=i(100),n=i(99),r=Object.prototype.propertyIsEnumerable,o=Object.getOwnPropertySymbols,h=o?function(t){return null==t?[]:(t=Object(t),s(o(t),function(e){return r.call(t,e)}))}:n;t.exports=h},function(t,e){t.exports=function(t,e){for(var i=-1,s=e.length,n=t.length;++i<s;)t[n+i]=e[i];return t}},function(t,e,i){var s=i(102),n=i(1);t.exports=function(t,e,i){var r=e(t);return n(t)?r:s(r,i(t))}},function(t,e,i){var s=i(103),n=i(101),r=i(18);t.exports=function(t){return s(t,r,n)}},function(t,e,i){var s=i(104),n=1,r=Object.prototype.hasOwnProperty;t.exports=function(t,e,i,o,h,a){var u=i&n,l=s(t),c=l.length;if(c!=s(e).length&&!u)return!1;for(var p=c;p--;){var f=l[p];if(!(u?f in e:r.call(e,f)))return!1}var m=a.get(t);if(m&&a.get(e))return m==e;var d=!0;a.set(t,e),a.set(e,t);for(var _=u;++p<c;){var g=t[f=l[p]],R=e[f];if(o)var b=u?o(R,g,f,e,t,a):o(g,R,f,t,e,a);if(!(void 0===b?g===R||h(g,R,i,o,a):b)){d=!1;break}_||(_="constructor"==f)}if(d&&!_){var y=t.constructor,v=e.constructor;y!=v&&"constructor"in t&&"constructor"in e&&!("function"==typeof y&&y instanceof y&&"function"==typeof v&&v instanceof v)&&(d=!1)}return a.delete(t),a.delete(e),d}},function(t,e){t.exports=function(t){var e=-1,i=Array(t.size);return t.forEach(function(t){i[++e]=t}),i}},function(t,e){t.exports=function(t){var e=-1,i=Array(t.size);return t.forEach(function(t,s){i[++e]=[s,t]}),i}},function(t,e,i){var s=i(0).Uint8Array;t.exports=s},function(t,e,i){var s=i(11),n=i(108),r=i(41),o=i(36),h=i(107),a=i(106),u=1,l=2,c="[object Boolean]",p="[object Date]",f="[object Error]",m="[object Map]",d="[object Number]",_="[object RegExp]",g="[object Set]",R="[object String]",b="[object Symbol]",y="[object ArrayBuffer]",v="[object DataView]",S=s?s.prototype:void 0,C=S?S.valueOf:void 0;t.exports=function(t,e,i,s,S,E,A){switch(i){case v:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case y:return!(t.byteLength!=e.byteLength||!E(new n(t),new n(e)));case c:case p:case d:return r(+t,+e);case f:return t.name==e.name&&t.message==e.message;case _:case R:return t==e+"";case m:var O=h;case g:var T=s&u;if(O||(O=a),t.size!=e.size&&!T)return!1;var D=A.get(t);if(D)return D==e;s|=l,A.set(t,e);var I=o(O(t),O(e),s,S,E,A);return A.delete(t),I;case b:if(C)return C.call(t)==C.call(e)}return!1}},function(t,e){t.exports=function(t,e){return t.has(e)}},function(t,e){t.exports=function(t,e){for(var i=-1,s=null==t?0:t.length;++i<s;)if(e(t[i],i,t))return!0;return!1}},function(t,e){t.exports=function(t){return this.__data__.has(t)}},function(t,e){var i="__lodash_hash_undefined__";t.exports=function(t){return this.__data__.set(t,i),this}},function(t,e,i){var s=i(19),n=i(113),r=i(112);function o(t){var e=-1,i=null==t?0:t.length;for(this.__data__=new s;++e<i;)this.add(t[e])}o.prototype.add=o.prototype.push=n,o.prototype.has=r,t.exports=o},function(t,e,i){var s=i(42),n=i(36),r=i(109),o=i(105),h=i(87),a=i(1),u=i(34),l=i(31),c=1,p="[object Arguments]",f="[object Array]",m="[object Object]",d=Object.prototype.hasOwnProperty;t.exports=function(t,e,i,_,g,R){var b=a(t),y=a(e),v=b?f:h(t),S=y?f:h(e),C=(v=v==p?m:v)==m,E=(S=S==p?m:S)==m,A=v==S;if(A&&u(t)){if(!u(e))return!1;b=!0,C=!1}if(A&&!C)return R||(R=new s),b||l(t)?n(t,e,i,_,g,R):r(t,e,v,i,_,g,R);if(!(i&c)){var O=C&&d.call(t,"__wrapped__"),T=E&&d.call(e,"__wrapped__");if(O||T){var D=O?t.value():t,I=T?e.value():e;return R||(R=new s),g(D,I,i,_,R)}}return!!A&&(R||(R=new s),o(t,e,i,_,g,R))}},function(t,e,i){var s=i(8);t.exports=function(t,e){var i=s(this,t),n=i.size;return i.set(t,e),this.size+=i.size==n?0:1,this}},function(t,e,i){var s=i(8);t.exports=function(t){return s(this,t).has(t)}},function(t,e,i){var s=i(8);t.exports=function(t){return s(this,t).get(t)}},function(t,e){t.exports=function(t){var e=typeof t;return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==t:null===t}},function(t,e,i){var s=i(8);t.exports=function(t){var e=s(this,t).delete(t);return this.size-=e?1:0,e}},function(t,e,i){var s=i(9),n="__lodash_hash_undefined__";t.exports=function(t,e){var i=this.__data__;return this.size+=this.has(t)?0:1,i[t]=s&&void 0===e?n:e,this}},function(t,e,i){var s=i(9),n=Object.prototype.hasOwnProperty;t.exports=function(t){var e=this.__data__;return s?void 0!==e[t]:n.call(e,t)}},function(t,e,i){var s=i(9),n="__lodash_hash_undefined__",r=Object.prototype.hasOwnProperty;t.exports=function(t){var e=this.__data__;if(s){var i=e[t];return i===n?void 0:i}return r.call(e,t)?e[t]:void 0}},function(t,e){t.exports=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}},function(t,e,i){var s=i(9);t.exports=function(){this.__data__=s?s(null):{},this.size=0}},function(t,e,i){var s=i(125),n=i(124),r=i(123),o=i(122),h=i(121);function a(t){var e=-1,i=null==t?0:t.length;for(this.clear();++e<i;){var s=t[e];this.set(s[0],s[1])}}a.prototype.clear=s,a.prototype.delete=n,a.prototype.get=r,a.prototype.has=o,a.prototype.set=h,t.exports=a},function(t,e,i){var s=i(126),n=i(13),r=i(20);t.exports=function(){this.size=0,this.__data__={hash:new s,map:new(r||n),string:new s}}},function(t,e){t.exports=function(t,e){return null==t?void 0:t[e]}},function(t,e,i){var s=i(0)["__core-js_shared__"];t.exports=s},function(t,e,i){var s,n=i(129),r=(s=/[^.]+$/.exec(n&&n.keys&&n.keys.IE_PROTO||""))?"Symbol(src)_1."+s:"";t.exports=function(t){return!!r&&r in t}},function(t,e){var i=Object.prototype.toString;t.exports=function(t){return i.call(t)}},function(t,e,i){var s=i(11),n=Object.prototype,r=n.hasOwnProperty,o=n.toString,h=s?s.toStringTag:void 0;t.exports=function(t){var e=r.call(t,h),i=t[h];try{t[h]=void 0;var s=!0}catch(t){}var n=o.call(t);return s&&(e?t[h]=i:delete t[h]),n}},function(t,e){var i;i=function(){return this}();try{i=i||Function("return this")()||(0,eval)("this")}catch(t){"object"==typeof window&&(i=window)}t.exports=i},function(t,e,i){var s=i(40),n=i(130),r=i(10),o=i(38),h=/^\[object .+?Constructor\]$/,a=Function.prototype,u=Object.prototype,l=a.toString,c=u.hasOwnProperty,p=RegExp("^"+l.call(c).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");t.exports=function(t){return!(!r(t)||n(t))&&(s(t)?p:h).test(o(t))}},function(t,e,i){var s=i(13),n=i(20),r=i(19),o=200;t.exports=function(t,e){var i=this.__data__;if(i instanceof s){var h=i.__data__;if(!n||h.length<o-1)return h.push([t,e]),this.size=++i.size,this;i=this.__data__=new r(h)}return i.set(t,e),this.size=i.size,this}},function(t,e){t.exports=function(t){return this.__data__.has(t)}},function(t,e){t.exports=function(t){return this.__data__.get(t)}},function(t,e){t.exports=function(t){var e=this.__data__,i=e.delete(t);return this.size=e.size,i}},function(t,e,i){var s=i(13);t.exports=function(){this.__data__=new s,this.size=0}},function(t,e,i){var s=i(12);t.exports=function(t,e){var i=this.__data__,n=s(i,t);return n<0?(++this.size,i.push([t,e])):i[n][1]=e,this}},function(t,e,i){var s=i(12);t.exports=function(t){return s(this.__data__,t)>-1}},function(t,e,i){var s=i(12);t.exports=function(t){var e=this.__data__,i=s(e,t);return i<0?void 0:e[i][1]}},function(t,e,i){var s=i(12),n=Array.prototype.splice;t.exports=function(t){var e=this.__data__,i=s(e,t);return!(i<0||(i==e.length-1?e.pop():n.call(e,i,1),--this.size,0))}},function(t,e){t.exports=function(){this.__data__=[],this.size=0}},function(t,e,i){var s=i(42),n=i(37),r=1,o=2;t.exports=function(t,e,i,h){var a=i.length,u=a,l=!h;if(null==t)return!u;for(t=Object(t);a--;){var c=i[a];if(l&&c[2]?c[1]!==t[c[0]]:!(c[0]in t))return!1}for(;++a<u;){var p=(c=i[a])[0],f=t[p],m=c[1];if(l&&c[2]){if(void 0===f&&!(p in t))return!1}else{var d=new s;if(h)var _=h(f,m,p,t,e,d);if(!(void 0===_?n(m,f,r|o,h,d):_))return!1}}return!0}},function(t,e,i){var s=i(145),n=i(82),r=i(28);t.exports=function(t){var e=n(t);return 1==e.length&&e[0][2]?r(e[0][0],e[0][1]):function(i){return i===t||s(i,t,e)}}},function(t,e,i){var s=i(43),n=i(30),r=i(18);t.exports=function(t){return function(e,i,o){var h=Object(e);if(!n(e)){var a=s(i,3);e=r(e),i=function(t){return a(h[t],t,h)}}var u=t(e,i,o);return u>-1?h[a?e[u]:u]:void 0}}},function(t,e,i){var s=i(147)(i(66));t.exports=s},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.GameComponent=void 0;var s,n=i(148),r=(s=n)&&s.__esModule?s:{default:s},o=function(){function t(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,i,s){return i&&t(e.prototype,i),s&&t(e,s),e}}(),h=(i(15),i(45),i(55)),a=i(53),u=i(52),l=i(49),c=i(2);var p=function(t){function e(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var t=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,{templateUrl:"game/game.html"}));return t.animationFrameRequestID=0,t.gameSlug=/^\/*(\S+)$/.exec(document.location.pathname)[1],t.gameInfo=null,t.titleElement=t.getElementById("title"),t.titleElement.innerText+=" "+t.gameSlug,t.createServerButton=t.getElementById("create-server-button"),t.createServerButton.addEventListener("click",function(){return t.createServer()}),t.emulator=t.getElementById("emulator"),t.coverImage=t.getElementById("cover-image"),t.roomList=t.getElementById("room-list"),t.roomList.addEventListener("room-selected",function(e){return t.joinRoom(e.detail)}),t.screen=t.getElementById("screen"),t.input=new h.KeyboardInput({onButtonDown:function(e,i){return t.sync.buttonDown(i)},onButtonUp:function(e,i){return t.sync.buttonUp(i)}}),t.multiplayerClient=new a.MultiplayerClient({onRoomListChange:function(e){return t.roomList.setRoomList(e)},onUserConnected:function(e){return t.onUserConnected(e)},onEventReceived:function(e,i,s){switch(e){case 0:t.sync=new l.SlaveSync(t.peerDataChannel,t.screen),t.initPeerConnection(!1),t.peerConnection.setRemoteDescription(i),t.peerConnection.createAnswer().then(function(e){t.peerConnection.setLocalDescription(e),t.multiplayerClient.sendMessage(1,e)}).catch(function(t){throw t});break;case 1:t.peerConnection.setRemoteDescription(i);break;case 2:t.peerConnection.addIceCandidate(i)}}}),t.multiplayerClient.start(),t.peerConnection=null,t.peerDataChannel=null,t.isMaster=!1,t.sync=null,t}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,c.WebComponent),o(e,[{key:"createServer",value:function(){this.multiplayerClient.createRoom(void 0)}},{key:"onUserConnected",value:function(t){var e=this;this.isMaster=!0,this.sync=new u.MasterSync(this.peerDataChannel,this.screen),this.initPeerConnection(!0),this.peerConnection.createOffer().then(function(t){e.peerConnection.setLocalDescription(t),e.multiplayerClient.sendMessage(0,t)}).catch(function(t){throw t})}},{key:"joinRoom",value:function(t){this.multiplayerClient.joinRoom(t.id)}},{key:"initPeerConnection",value:function(t){var e=this;this.peerConnection=new RTCPeerConnection({iceServers:[{urls:"turn:numb.viagenie.ca",username:"8ae67aeb@i.ua",credential:"sEFcwh22UAU6MGK608k4"}]}),this.peerConnection.onconnectionstatechange=function(t){return console.info("onconnectionstatechange",t)},this.peerConnection.onidpassertionerror=function(t){return console.info("onidpassertionerror",t)},this.peerConnection.onidpvalidationerror=function(t){return console.info("onidpvalidationerror",t)},this.peerConnection.onnegotiationneeded=function(t){return console.info("onnegotiationneeded",t)},this.peerConnection.oniceconnectionstatechange=function(t){return console.info("oniceconnectionstatechange",t)},this.peerConnection.onicecandidateerror=function(t){return console.info("onicecandidateerror",t)},this.peerConnection.onicecandidate=function(t){t.candidate&&e.multiplayerClient.sendMessage(2,t.candidate)},t?(this.peerDataChannel=this.peerConnection.createDataChannel("sendChannel",{binaryType:"arraybuffer"}),this.sync._peerDataChannel=this.peerDataChannel,this.peerDataChannel.onopen=function(t){return e.onDataChannelOpen(t)},this.peerDataChannel.onclose=function(t){return e.onDataChannelClose(t)},this.peerDataChannel.onmessage=function(t){return e.onDataChannelMessage(t)},this.peerDataChannel.onerror=function(t){return e.onDataChannelError(t)}):this.peerConnection.ondatachannel=function(t){e.peerDataChannel=t.channel,e.sync._peerDataChannel=t.channel,e.peerDataChannel.onopen=function(t){return e.onDataChannelOpen(t)},e.peerDataChannel.onclose=function(t){return e.onDataChannelClose(t)},e.peerDataChannel.onmessage=function(t){return e.onDataChannelMessage(t)},e.peerDataChannel.onerror=function(t){return e.onDataChannelError(t)}}}},{key:"onDataChannelOpen",value:function(t){var e=this;console.info("onDataChannelOpen",t),new Promise(function(t,i){e.isMaster?e.loadGame(e.gameSlug).then(function(e){return t(e)}).catch(function(t){return i(t)}):t(null)}).then(function(t){e.sync.start(t),e.animationFrameRequestID=window.requestAnimationFrame(function(t){return e.frame(t)})}).catch(function(t){throw t})}},{key:"onDataChannelClose",value:function(t){console.info("onDataChannelClose",t)}},{key:"onDataChannelMessage",value:function(t){this.sync.handleEvent(t.data)}},{key:"onDataChannelError",value:function(t){console.error("Data channel error: %o",t)}},{key:"loadGame",value:function(t){var e=this;return window.fetch("/data/index.json").then(function(t){return t.json()}).then(function(i){if(e.gameInfo=(0,r.default)(i,function(e){return e.slug===t}),!e.gameInfo)throw'Game not found by slug="'+t+'".';var s="/data/"+t+"/roms/"+t+".nes";return window.fetch(s)}).then(function(t){return t.arrayBuffer()}).then(function(t){var i=new window.TextDecoder("x-user-defined").decode(t);e.sync.start(i),e.animationFrameRequestID=window.requestAnimationFrame(function(t){return e.frame(t)})})}},{key:"frame",value:function(t){var e=this;try{this.sync.frame(t)}catch(t){console.error(t)}this.animationFrameRequestID=window.requestAnimationFrame(function(t){return e.frame(t)})}}]),e}();e.GameComponent=p},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.HomeGameListItemComponent=void 0;var s=function(){function t(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,i,s){return i&&t(e.prototype,i),s&&t(e,s),e}}(),n=i(2);var r=function(t){function e(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var t=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,{templateUrl:"home/home-game-list-item/home-game-list-item.html"}));return t.titleElement=t.getElementById("title"),t.imageElement=t.getElementById("image"),t}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,n.WebComponent),s(e,[{key:"title",get:function(){return this.getAttribute("title")},set:function(t){this.titleElement.innerText=t,t?this.setAttribute("title",t):this.removeAttribute("title")}},{key:"imageUrl",get:function(){return this.getAttribute("image-url")},set:function(t){this.imageElement.src=t,t?this.setAttribute("image-url",t):this.removeAttribute("image-url")}}]),e}();e.HomeGameListItemComponent=r},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.HomeFilterComponent=void 0;var s=function(){function t(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,i,s){return i&&t(e.prototype,i),s&&t(e,s),e}}(),n=i(2);var r=function(t){function e(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var t=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,{templateUrl:"home/home-filter/home-filter.html"}));return t.searchTextElement=t.getElementById("search-text"),t.searchTextElement.addEventListener("input",function(e){return t.onSearchTextInput(e)}),t}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,n.WebComponent),s(e,[{key:"onSearchTextInput",value:function(t){this.fireChangeEvent()}},{key:"fireChangeEvent",value:function(){var t=new CustomEvent("change",{detail:{text:this.searchTextElement.value}});this.dispatchEvent(t)}}]),e}();e.HomeFilterComponent=r},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.HomeComponent=void 0;var s=function(){function t(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,i,s){return i&&t(e.prototype,i),s&&t(e,s),e}}(),n=i(21),r=i(2);var o=function(t){function e(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var t=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,{templateUrl:"home/home.html"}));return t.games=[],t.gameListOffset=0,t.filterArgs={},t.filter=t.getElementById("filter"),t.filter.addEventListener("change",function(e){return t.onFilterChange(e)}),t.gameListUlElement=t.getElementById("game-list"),t.showMoreGamesLink=t.getElementById("show-more-games-link"),t.showMoreGamesLink.addEventListener("click",function(){return t.showMoreGames()}),t}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,r.WebComponent),s(e,[{key:"connectedCallback",value:function(){var t=this;fetch("/data/index.json").then(function(t){return t.json()}).then(function(e){t.games=(e||[]).map(function(t){return{slug:t.slug,name:t.name,imageUrl:"\\data\\"+t.slug+"\\"+t.imageUrl}}),t.renderGameList(t.games,0,10)}).catch(function(t){throw t})}},{key:"renderGameList",value:function(t,e,i){var s=this;0===e&&(n.DOMUtils.empty(this.gameListUlElement),this.showMoreGamesLink.style.display="block"),t.slice(e,e+i).forEach(function(t){var e=document.createElement("li"),i=document.createElement("x-route-link");i.path="/"+t.slug;var n=document.createElement("x-home-game-list-item");n.title=t.name,n.imageUrl=t.imageUrl,i.appendChild(n),e.appendChild(i),s.gameListUlElement.appendChild(e)}),e+i>=t.length-1&&(this.showMoreGamesLink.style.display="none")}},{key:"showMoreGames",value:function(){this.gameListOffset+=10,this.renderGameList(this.filterGames(this.games,this.filterArgs),this.gameListOffset,10)}},{key:"onFilterChange",value:function(t){this.filterArgs=t.detail||{},this.gameListOffset=0,this.renderGameList(this.filterGames(this.games,this.filterArgs),0,10)}},{key:"filterGames",value:function(t,e){return t.filter(function(t){return""===(e.text||"").trim()||(t.name||"").trim().toUpperCase().includes((e.text||"").trim().toUpperCase())})}}]),e}();e.HomeComponent=o},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,i,s){return i&&t(e.prototype,i),s&&t(e,s),e}}();var n=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.routes=[],this.root="/",this.currentFragment=null}return s(t,[{key:"getFragment",value:function(){var t="";return t=(t=this.clearSlashes(decodeURI(location.pathname+location.search))).replace(/\?(.*)$/,""),t="/"!==this.root?t.replace(this.root,""):t,this.clearSlashes(t)}},{key:"clearSlashes",value:function(t){return t.toString().replace(/\/$/,"").replace(/^\//,"")}},{key:"add",value:function(t,e){return"function"==typeof t&&(e=t,t=""),this.routes.push({re:t,handler:e}),this}},{key:"remove",value:function(t){for(var e,i=0;this.routes.length,e=this.routes[i];i++)if(e.handler===t||e.re.toString()===t.toString())return this.routes.splice(i,1),this;return this}},{key:"flush",value:function(){return this.routes=[],this.root="/",this}},{key:"check",value:function(t){for(var e=t||this.getFragment(),i=0;i<this.routes.length;i++){var s=e.match(this.routes[i].re);if(s)return s.shift(),this.routes[i].handler.apply({},s),this}return this}},{key:"listen",value:function(){var t=this;this.currentFragment=this.getFragment(),this.fireRoute(),window.addEventListener("popstate",function(){return t.onPopstate()},!1);var e="ActiveXObject"in window,i=!!window.navigator.userAgent.match(/Edge/);return(e||i)&&window.addEventListener("hashchange",function(){return t.onPopstate()},!1),this}},{key:"onPopstate",value:function(){this.currentFragment!==this.getFragment()&&this.fireRoute()}},{key:"fireRoute",value:function(){this.currentFragment=this.getFragment(),this.check()}},{key:"navigate",value:function(t){return t=t||"",history.pushState(null,null,this.root+this.clearSlashes(t)),this.fireRoute(),this}}]),t}();e.Router=n},function(t,e,i){"use strict";var s=function(){function t(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,i,s){return i&&t(e.prototype,i),s&&t(e,s),e}}(),n=(i(45),i(44)),r=i(152),o=i(151),h=i(150),a=i(149),u=i(48),l=i(47),c=i(46);(function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}return s(t,null,[{key:"start",value:function(){t.defineCustomElements()}},{key:"defineCustomElements",value:function(){window.customElements.define("x-app",n.AppComponent),window.customElements.define("x-home",r.HomeComponent),window.customElements.define("x-home-filter",o.HomeFilterComponent),window.customElements.define("x-home-game-list-item",h.HomeGameListItemComponent),window.customElements.define("x-game",a.GameComponent),window.customElements.define("x-game-multiplayer-room-list",u.GameMultiplayerRoomListComponent),window.customElements.define("x-screen",l.ScreenComponent),window.customElements.define("x-route-link",c.RouteLinkComponent)}}]),t})().start()}]);